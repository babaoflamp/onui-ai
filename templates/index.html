{% extends "base.html" %} {% block title %}오누이 한국어 학습 플랫폼{% endblock
%} {% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
  <!-- Hero Section -->
  <div class="text-center py-12">
    <h1 class="text-5xl font-bold text-gray-900 mb-4">
      🌸 오누이 한국어 학습 플랫폼
    </h1>
    <p class="text-xl text-gray-600 mb-8">
      AI와 함께하는 즐거운 한국어 학습 여정
    </p>
  </div>

  <!-- Auth Status Alert -->
  <div
    id="authAlert"
    class="bg-emerald-50 border border-emerald-200 rounded-2xl mb-8 p-4"
    style="display: none"
  >
    <div class="flex items-center gap-3">
      <span class="text-xl">✓</span>
      <div>
        <p class="font-semibold text-emerald-900">로그인되었습니다</p>
        <p class="text-sm text-emerald-700" id="authAlertText"></p>
      </div>
    </div>
  </div>

  <!-- Landing Intake (가입/취향 수집) -->
  <div
    id="signupSection"
    class="bg-white rounded-2xl shadow-lg border border-orange-100 mb-12 p-6 lg:p-8"
  >
    <div
      class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6 mb-6"
    >
      <div>
        <p
          class="text-xs uppercase tracking-wide text-orange-500 font-semibold"
        >
          랜딩 섹션
        </p>
        <h2 class="text-2xl font-bold text-gray-900 mt-1">
          회원가입 & 취향 정보 수집
        </h2>
        <p class="text-sm text-gray-600 mt-2">
          이메일과 8자 이상의 비밀번호를 입력해 실제 계정을 생성하세요.
          비밀번호는 PBKDF2로 해시되어 안전하게 저장되며, 취향
          정보(국적·관심사·학습 목표·스타일·시간대)는 맞춤 학습을 위해
          선택적으로 수집합니다.
        </p>
      </div>
      <div
        class="flex items-center gap-2 text-sm text-gray-600 bg-orange-50 border border-orange-100 rounded-full px-3 py-2"
      >
        <span class="text-lg">🛠️</span>
        <span>실제 가입 · SQLite 저장</span>
      </div>
    </div>

    <form id="landingForm" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-800">이메일</label>
          <input
            name="email"
            type="email"
            required
            class="w-full border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-400"
            placeholder="you@example.com"
          />
        </div>
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-800">닉네임</label>
          <input
            name="nickname"
            type="text"
            required
            class="w-full border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-400"
            placeholder="학습자 닉네임"
          />
        </div>
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-800">비밀번호</label>
          <input
            name="password"
            type="password"
            required
            class="w-full border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-400"
            placeholder="********"
          />
        </div>
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-800"
            >비밀번호 확인</label
          >
          <input
            name="password_confirm"
            type="password"
            required
            class="w-full border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-400"
            placeholder="********"
          />
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-800"
            >국적 / 모국어</label
          >
          <input
            name="native_lang"
            type="text"
            class="w-full border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-400"
            placeholder="예: 일본 / 일본어"
          />
        </div>
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-800"
            >소속(회사/학교)</label
          >
          <input
            name="affiliation"
            type="text"
            class="w-full border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-400"
            placeholder="예: OO대학교 / OO회사"
          />
        </div>
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-800"
            >선호 학습 시간대</label
          >
          <select
            name="time_pref"
            class="w-full border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-400"
          >
            <option value="">선택</option>
            <option>아침</option>
            <option>점심</option>
            <option>저녁</option>
            <option>주말</option>
          </select>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-800"
            >관심 분야 (복수 선택)</label
          >
          <div class="grid grid-cols-2 gap-2 text-sm">
            {% set interests = ["음식", "K-Pop", "영화", "드라마", "여행",
            "비즈니스"] %} {% for it in interests %}
            <label class="flex items-center gap-2 text-gray-700">
              <input
                type="checkbox"
                name="interests"
                value="{{ it }}"
                class="text-orange-500 rounded"
              />
              {{ it }}
            </label>
            {% endfor %}
          </div>
        </div>
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-800">학습 목표</label>
          <select
            name="goal"
            class="w-full border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-400"
          >
            <option value="">선택</option>
            <option>취미</option>
            <option>자격증(TOPIK)</option>
            <option>유학/취업</option>
            <option>비즈니스 커뮤니케이션</option>
          </select>
          <label class="text-sm font-semibold text-gray-800"
            >관심 시험/레벨</label
          >
          <input
            name="exam_level"
            type="text"
            class="w-full border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-400"
            placeholder="예: TOPIK II, CEFR B1"
          />
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-800">학습 계기</label>
          <textarea
            name="reason"
            rows="2"
            class="w-full border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-400"
            placeholder="한국어를 배우게 된 계기를 적어주세요"
          ></textarea>
        </div>
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-800"
            >선호 학습 스타일</label
          >
          <div class="grid grid-cols-2 gap-2 text-sm">
            {% set styles = ["동영상 중심", "텍스트 중심", "문제 중심",
            "실습/대화"] %} {% for st in styles %}
            <label class="flex items-center gap-2 text-gray-700">
              <input
                type="radio"
                name="style"
                value="{{ st }}"
                class="text-orange-500"
              />
              {{ st }}
            </label>
            {% endfor %}
          </div>
        </div>
      </div>

      <div
        class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"
      >
        <div id="landingStatus" class="text-sm text-gray-600">
          입력 후 제출하면 계정이 생성됩니다.
        </div>
        <button
          type="submit"
          class="inline-flex items-center justify-center bg-gradient-to-r from-orange-500 to-pink-500 text-white px-5 py-2.5 rounded-lg shadow hover:from-orange-600 hover:to-pink-600 transition-all"
        >
          제출 및 저장
        </button>
      </div>
    </form>
  </div>

  <!-- Learning Modes Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-12">
    <!-- AI 학습 도구 -->
    <a href="/learning" class="block">
      <div
        class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 border-transparent hover:border-orange-500"
      >
        <div class="text-4xl mb-4">🤖</div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">AI 학습 도구</h3>
        <p class="text-gray-600 text-sm mb-4">
          AI 기반 맞춤형 교재 생성, 발음 교정, 작문 유창성 테스트
        </p>
        <div class="flex flex-wrap gap-2">
          <span
            class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded"
            >콘텐츠 생성</span
          >
          <span
            class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded"
            >발음 교정</span
          >
          <span
            class="inline-block bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded"
            >작문 테스트</span
          >
        </div>
      </div>
    </a>

    <!-- 단어 순서 맞추기 -->
    <a href="/word-puzzle" class="block">
      <div
        class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 border-transparent hover:border-orange-500"
      >
        <div class="text-4xl mb-4">🎯</div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">단어 순서 맞추기</h3>
        <p class="text-gray-600 text-sm mb-4">
          드래그 앤 드롭으로 한국어 문장의 어순을 연습하세요
        </p>
        <div class="flex flex-wrap gap-2">
          <span
            class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded"
            >A1-B1</span
          >
          <span
            class="inline-block bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded"
            >어순 연습</span
          >
          <span
            class="inline-block bg-pink-100 text-pink-800 text-xs px-2 py-1 rounded"
            >게임</span
          >
        </div>
      </div>
    </a>

    <!-- 오늘의 표현 -->
    <a href="/daily-expression" class="block">
      <div
        class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 border-transparent hover:border-orange-500"
      >
        <div class="text-4xl mb-4">💬</div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">오늘의 표현</h3>
        <p class="text-gray-600 text-sm mb-4">
          매일 새로운 한국어 표현과 문화를 배워보세요
        </p>
        <div class="flex flex-wrap gap-2">
          <span
            class="inline-block bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded"
            >일상 표현</span
          >
          <span
            class="inline-block bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded"
            >문화 노트</span
          >
          <span
            class="inline-block bg-red-100 text-red-800 text-xs px-2 py-1 rounded"
            >데일리</span
          >
        </div>
      </div>
    </a>

    <!-- 단어 꽃밭 -->
    <a href="/vocab-garden" class="block">
      <div
        class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 border-transparent hover:border-orange-500"
      >
        <div class="text-4xl mb-4">🌸</div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">단어 꽃밭</h3>
        <p class="text-gray-600 text-sm mb-4">
          예쁜 꽃 카드와 함께 단어를 암기하고 예문을 학습하세요
        </p>
        <div class="flex flex-wrap gap-2">
          <span
            class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded"
            >단어 암기</span
          >
          <span
            class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded"
            >레벨별</span
          >
          <span
            class="inline-block bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded"
            >예문</span
          >
        </div>
      </div>
    </a>

    <!-- 발음 연속 -->
    <a href="/pronunciation-practice" class="block">
      <div
        class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 border-transparent hover:border-orange-500"
      >
        <div class="text-4xl mb-4">🎧</div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">발음 연습</h3>
        <p class="text-gray-600 text-sm mb-4">
          연속적인 발음 연습으로 리듬과 유창성을 기르고 즉시 피드백을 받아보세요
        </p>
        <div class="flex flex-wrap gap-2">
          <span
            class="inline-block bg-red-100 text-red-800 text-xs px-2 py-1 rounded"
            >발음 연습</span
          >
          <span
            class="inline-block bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded"
            >연속 연습</span
          >
          <span
            class="inline-block bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded"
            >피드백</span
          >
        </div>
      </div>
    </a>
  </div>

  <!-- Features Section -->
  <div class="bg-white rounded-2xl p-8 shadow-lg mb-12">
    <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">
      🎓 학습 플랫폼 특징
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="text-center">
        <div class="text-3xl mb-3">🤖</div>
        <h4 class="font-bold text-gray-900 mb-2">AI 기반 학습</h4>
        <p class="text-sm text-gray-600">
          로컬 LLM(Ollama EXAONE)을 활용한 맞춤형 학습 콘텐츠 생성
        </p>
      </div>
      <div class="text-center">
        <div class="text-3xl mb-3">🎮</div>
        <h4 class="font-bold text-gray-900 mb-2">재미있는 게임</h4>
        <p class="text-sm text-gray-600">
          드래그 앤 드롭, 슬라이더 등 인터랙티브한 학습 경험
        </p>
      </div>
      <div class="text-center">
        <div class="text-3xl mb-3">📊</div>
        <h4 class="font-bold text-gray-900 mb-2">레벨 시스템</h4>
        <p class="text-sm text-gray-600">
          CEFR 기준(A1, A2, B1) 체계적인 난이도 관리
        </p>
      </div>
    </div>
  </div>

  <!-- Quick Start Guide -->
  <div
    class="bg-gradient-to-r from-orange-50 to-pink-50 rounded-2xl p-8 shadow-lg"
  >
    <h2 class="text-2xl font-bold text-gray-900 mb-4 text-center">
      🚀 시작하기
    </h2>
    <div class="space-y-3 max-w-2xl mx-auto">
      <div class="flex items-start">
        <span
          class="inline-block bg-orange-500 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold text-sm mr-3 flex-shrink-0 mt-1"
          >1</span
        >
        <p class="text-gray-700">
          <strong>AI 학습 도구</strong>로 시작하여 관심사에 맞는 교재를
          생성하세요
        </p>
      </div>
      <div class="flex items-start">
        <span
          class="inline-block bg-orange-500 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold text-sm mr-3 flex-shrink-0 mt-1"
          >2</span
        >
        <p class="text-gray-700">
          <strong>단어 꽃밭</strong>에서 기초 단어를 익히고 예문을 학습하세요
        </p>
      </div>
      <div class="flex items-start">
        <span
          class="inline-block bg-orange-500 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold text-sm mr-3 flex-shrink-0 mt-1"
          >3</span
        >
        <p class="text-gray-700">
          <strong>단어 순서 맞추기</strong>로 한국어 어순을 게임처럼 연습하세요
        </p>
      </div>
      <div class="flex items-start">
        <span
          class="inline-block bg-orange-500 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold text-sm mr-3 flex-shrink-0 mt-1"
          >4</span
        >
        <p class="text-gray-700">
          매일 <strong>오늘의 표현</strong>을 확인하여 실용적인 한국어 표현을
          배우세요
        </p>
      </div>
      <div class="flex items-start">
        <span
          class="inline-block bg-orange-500 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold text-sm mr-3 flex-shrink-0 mt-1"
          >5</span
        >
        <p class="text-gray-700">
          <strong>발음 연습</strong>으로 리듬과 억양을 개선하고 즉시 피드백을
          받아보세요
        </p>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  (function () {
    const form = document.getElementById("landingForm");
    const statusEl = document.getElementById("landingStatus");
    if (!form) return;

    function setStatus(msg, ok = true) {
      if (!statusEl) return;
      statusEl.textContent = msg;
      statusEl.className = ok
        ? "text-sm text-emerald-600"
        : "text-sm text-red-600";
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const fd = new FormData(form);

      // Client validation: password match and length
      const pw = fd.get("password") || "";
      const pc = fd.get("password_confirm") || "";
      if (pw !== pc) {
        setStatus("비밀번호가 일치하지 않습니다.", false);
        return;
      }
      if (pw.length < 8) {
        setStatus("비밀번호는 8자 이상이어야 합니다.", false);
        return;
      }

      // Gather checkbox/radio into arrays
      const interests = Array.from(
        form.querySelectorAll('input[name="interests"]:checked')
      ).map((c) => c.value);
      const style =
        (form.querySelector('input[name="style"]:checked') || {}).value || "";

      const payload = {
        email: fd.get("email") || "",
        nickname: fd.get("nickname") || "",
        password: pw,
        native_lang: fd.get("native_lang") || "",
        affiliation: fd.get("affiliation") || "",
        time_pref: fd.get("time_pref") || "",
        interests,
        goal: fd.get("goal") || "",
        exam_level: fd.get("exam_level") || "",
        reason: fd.get("reason") || "",
        style,
      };

      setStatus("가입 중...", true);

      try {
        const res = await fetch("/api/signup", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        if (!res.ok) {
          const error = await res.json().catch(() => ({ detail: "가입 실패" }));
          throw new Error(error.detail || "가입에 실패했습니다.");
        }
        const data = await res.json();
        setStatus(
          `✓ ${data.nickname}님 가입을 환영합니다! 이제 로그인해주세요.`
        );
        setTimeout(() => {
          window.location.href = "/login";
        }, 2000);
        form.reset();
      } catch (err) {
        console.error(err);
        setStatus(err.message || "가입 중 오류가 발생했습니다.", false);
      }
    });

    // Check if user is already logged in
    function updateSignupSectionVisibility() {
      const token = localStorage.getItem("auth_token");
      const nickname = localStorage.getItem("user_nickname");
      const signupSection = document.getElementById("signupSection");
      const authAlert = document.getElementById("authAlert");

      if (token && nickname) {
        if (signupSection) signupSection.style.display = "none";
        if (authAlert) {
          document.getElementById(
            "authAlertText"
          ).textContent = `${nickname}님으로 로그인되었습니다. 학습을 시작하세요!`;
          authAlert.style.display = "block";
        }
      } else {
        if (signupSection) signupSection.style.display = "block";
        if (authAlert) authAlert.style.display = "none";
      }
    }

    updateSignupSectionVisibility();
  })();
</script>
{% endblock %}
