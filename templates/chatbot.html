{% extends "base.html" %} {% block title %}AI ì±—ë´‡ | ì˜¤ëˆ„ì´ í•œêµ­ì–´{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="text-center mb-8">
    <h1 class="text-4xl font-bold text-gray-900 mb-2">ğŸ¤– AI í•œêµ­ì–´ íŠœí„°</h1>
    <p class="text-gray-600">í•œêµ­ì–´ í•™ìŠµì— ëŒ€í•´ ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”!</p>
  </div>

  <!-- Chat Container -->
  <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
    <!-- Chat Messages -->
    <div
      id="chat-messages"
      class="h-[500px] overflow-y-auto p-6 space-y-4 bg-gradient-to-b from-orange-50/30 to-white"
    >
      <!-- Welcome Message -->
      <div class="flex items-start space-x-3">
        <div class="flex-shrink-0">
          <div
            class="w-10 h-10 rounded-full bg-gradient-to-br from-orange-400 to-pink-400 flex items-center justify-center text-white font-bold"
          >
            AI
          </div>
        </div>
        <div class="flex-1">
          <div
            class="bg-white rounded-2xl rounded-tl-sm p-4 shadow-sm border border-gray-100"
          >
            <p class="text-gray-800">
              ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹<br />
              ì €ëŠ” í•œêµ­ì–´ í•™ìŠµì„ ë„ì™€ë“œë¦¬ëŠ” AI íŠœí„°ì…ë‹ˆë‹¤.<br />
              ë°œìŒ, ë¬¸ë²•, ë‹¨ì–´, ë¬¸í™” ë“± ë¬´ì—‡ì´ë“  í¸í•˜ê²Œ ì§ˆë¬¸í•´ì£¼ì„¸ìš”!
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="border-t border-gray-200 p-4 bg-white">
      <div class="flex space-x-3">
        <input
          type="text"
          id="user-input"
          placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
          class="flex-1 px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
          autocomplete="off"
        />
        <button
          id="send-button"
          class="px-6 py-3 bg-gradient-to-r from-orange-500 to-pink-500 text-white font-medium rounded-full hover:from-orange-600 hover:to-pink-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          ì „ì†¡
        </button>
      </div>
      <div class="mt-2 flex flex-wrap gap-2">
        <button
          class="suggestion-btn px-3 py-1 text-sm bg-orange-100 text-orange-700 rounded-full hover:bg-orange-200 transition-colors"
        >
          ë°œìŒ ì—°ìŠµ ë°©ë²• ì•Œë ¤ì¤˜
        </button>
        <button
          class="suggestion-btn px-3 py-1 text-sm bg-pink-100 text-pink-700 rounded-full hover:bg-pink-200 transition-colors"
        >
          ë°›ì¹¨ ë°œìŒì´ ì–´ë ¤ì›Œìš”
        </button>
        <button
          class="suggestion-btn px-3 py-1 text-sm bg-purple-100 text-purple-700 rounded-full hover:bg-purple-200 transition-colors"
        >
          ì¡´ëŒ“ë§ ì‚¬ìš©ë²•
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  #chat-messages::-webkit-scrollbar {
    width: 8px;
  }

  #chat-messages::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }

  #chat-messages::-webkit-scrollbar-thumb {
    background: #fb923c;
    border-radius: 10px;
  }

  #chat-messages::-webkit-scrollbar-thumb:hover {
    background: #f97316;
  }

  .typing-indicator {
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }

  .typing-indicator span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #fb923c;
    animation: typing 1.4s infinite;
  }

  .typing-indicator span:nth-child(2) {
    animation-delay: 0.2s;
  }

  .typing-indicator span:nth-child(3) {
    animation-delay: 0.4s;
  }

  @keyframes typing {
    0%,
    60%,
    100% {
      transform: translateY(0);
    }
    30% {
      transform: translateY(-10px);
    }
  }
</style>

<script>
  const chatMessages = document.getElementById("chat-messages");
  const userInput = document.getElementById("user-input");
  const sendButton = document.getElementById("send-button");
  const suggestionButtons = document.querySelectorAll(".suggestion-btn");

  // Add user message to chat
  function addUserMessage(text) {
    const messageDiv = document.createElement("div");
    messageDiv.className = "flex items-start space-x-3 justify-end";
    messageDiv.innerHTML = `
      <div class="flex-1 flex justify-end">
        <div class="bg-gradient-to-br from-orange-500 to-pink-500 rounded-2xl rounded-tr-sm p-4 shadow-sm max-w-[80%]">
          <p class="text-white">${escapeHtml(text)}</p>
        </div>
      </div>
      <div class="flex-shrink-0">
        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-gray-400 to-gray-600 flex items-center justify-center text-white font-bold">
          ë‚˜
        </div>
      </div>
    `;
    chatMessages.appendChild(messageDiv);
    scrollToBottom();
  }

  // Add AI message to chat
  function addAIMessage(text) {
    const messageDiv = document.createElement("div");
    messageDiv.className = "flex items-start space-x-3";
    messageDiv.innerHTML = `
      <div class="flex-shrink-0">
        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-orange-400 to-pink-400 flex items-center justify-center text-white font-bold">
          AI
        </div>
      </div>
      <div class="flex-1">
        <div class="bg-white rounded-2xl rounded-tl-sm p-4 shadow-sm border border-gray-100">
          <p class="text-gray-800">${escapeHtml(text).replace(
            /\n/g,
            "<br>"
          )}</p>
        </div>
      </div>
    `;
    chatMessages.appendChild(messageDiv);
    scrollToBottom();
  }

  // Add typing indicator
  function addTypingIndicator() {
    const typingDiv = document.createElement("div");
    typingDiv.id = "typing-indicator";
    typingDiv.className = "flex items-start space-x-3";
    typingDiv.innerHTML = `
      <div class="flex-shrink-0">
        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-orange-400 to-pink-400 flex items-center justify-center text-white font-bold">
          AI
        </div>
      </div>
      <div class="flex-1">
        <div class="bg-white rounded-2xl rounded-tl-sm p-4 shadow-sm border border-gray-100">
          <div class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    `;
    chatMessages.appendChild(typingDiv);
    scrollToBottom();
  }

  // Remove typing indicator
  function removeTypingIndicator() {
    const typingDiv = document.getElementById("typing-indicator");
    if (typingDiv) {
      typingDiv.remove();
    }
  }

  // Scroll to bottom
  function scrollToBottom() {
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  // Escape HTML
  function escapeHtml(text) {
    const div = document.createElement("div");
    div.textContent = text;
    return div.innerHTML;
  }

  // Send message
  async function sendMessage(message) {
    if (!message.trim()) return;

    // Add user message
    addUserMessage(message);
    userInput.value = "";
    sendButton.disabled = true;

    // Show typing indicator
    addTypingIndicator();

    try {
      const response = await fetch("/api/chatbot", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ message: message }),
      });

      const data = await response.json();

      // Remove typing indicator
      removeTypingIndicator();

      if (response.ok) {
        addAIMessage(data.response);
      } else {
        addAIMessage("ì£„ì†¡í•©ë‹ˆë‹¤. ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
      }
    } catch (error) {
      console.error("Error:", error);
      removeTypingIndicator();
      addAIMessage("ì£„ì†¡í•©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    } finally {
      sendButton.disabled = false;
      userInput.focus();
    }
  }

  // Event listeners
  sendButton.addEventListener("click", () => {
    sendMessage(userInput.value);
  });

  userInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
      sendMessage(userInput.value);
    }
  });

  suggestionButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      userInput.value = btn.textContent;
      sendMessage(btn.textContent);
    });
  });

  // Focus input on load
  userInput.focus();
</script>
{% endblock %}
