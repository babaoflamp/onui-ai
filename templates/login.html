{% extends "base.html" %} {% block title %}ë¡œê·¸ì¸ - ì˜¤ëˆ„ì´ í•œêµ­ì–´ í•™ìŠµ{%
endblock %} {% block content %}
<div
  class="min-h-screen bg-gradient-to-br from-orange-50 to-pink-50 flex items-center justify-center px-4"
>
  <div class="w-full max-w-md">
    <!-- Login Card -->
    <div class="bg-white rounded-3xl shadow-2xl p-8 border border-orange-100">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-2">ğŸŒ¸ ë¡œê·¸ì¸</h1>
        <p class="text-gray-600">ì˜¤ëˆ„ì´ í•œêµ­ì–´ í•™ìŠµ í”Œë«í¼ì— ì ‘ì†í•˜ì„¸ìš”</p>
      </div>

      <!-- Login Form -->
      <form id="loginForm" class="space-y-5">
        <!-- Email Input -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-800">ì´ë©”ì¼</label>
          <input
            name="email"
            type="email"
            required
            autocomplete="email"
            class="w-full border border-gray-200 rounded-lg px-4 py-3 focus:ring-2 focus:ring-orange-400 focus:border-transparent outline-none transition"
            placeholder="you@example.com"
          />
        </div>

        <!-- Password Input -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-800">ë¹„ë°€ë²ˆí˜¸</label>
          <input
            name="password"
            type="password"
            required
            autocomplete="current-password"
            class="w-full border border-gray-200 rounded-lg px-4 py-3 focus:ring-2 focus:ring-orange-400 focus:border-transparent outline-none transition"
            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
          />
        </div>

        <!-- Status Message -->
        <div
          id="loginStatus"
          class="text-sm text-gray-600 text-center min-h-6"
        ></div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="w-full bg-gradient-to-r from-orange-500 to-pink-500 text-white font-semibold py-3 rounded-lg shadow-lg hover:from-orange-600 hover:to-pink-600 transition-all duration-200 active:scale-95"
        >
          ë¡œê·¸ì¸
        </button>
      </form>

      <!-- Divider -->
      <div class="relative my-6">
        <div class="absolute inset-0 flex items-center">
          <div class="w-full border-t border-gray-200"></div>
        </div>
        <div class="relative flex justify-center text-sm">
          <span class="px-2 bg-white text-gray-500">ë˜ëŠ”</span>
        </div>
      </div>

      <!-- Signup Link -->
      <div class="text-center">
        <p class="text-gray-600 mb-3">ì•„ì§ ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?</p>
        <a
          href="/"
          class="inline-flex items-center justify-center text-white bg-gradient-to-r from-emerald-500 to-teal-500 px-6 py-2.5 rounded-lg font-semibold hover:from-emerald-600 hover:to-teal-600 transition-all"
        >
          íšŒì›ê°€ì…í•˜ê¸°
        </a>
      </div>

      <!-- Footer -->
      <div
        class="mt-8 pt-6 border-t border-gray-100 text-center text-xs text-gray-500"
      >
        <p>ğŸ›¡ï¸ ë¹„ë°€ë²ˆí˜¸ëŠ” PBKDF2ë¡œ ì•ˆì „í•˜ê²Œ ì•”í˜¸í™”ë©ë‹ˆë‹¤</p>
      </div>
    </div>

    <!-- Back to Home -->
    <div class="text-center mt-6">
      <a href="/" class="text-orange-600 hover:text-orange-700 font-medium"
        >â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a
      >
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  (function () {
    const form = document.getElementById("loginForm");
    const statusEl = document.getElementById("loginStatus");
    if (!form) return;

    function setStatus(msg, ok = true) {
      if (!statusEl) return;
      statusEl.textContent = msg;
      statusEl.className = ok
        ? "text-sm text-emerald-600 font-medium"
        : "text-sm text-red-600 font-medium";
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const fd = new FormData(form);

      const payload = {
        email: fd.get("email") || "",
        password: fd.get("password") || "",
      };

      setStatus("ë¡œê·¸ì¸ ì¤‘...", true);

      try {
        const res = await fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        if (!res.ok) {
          const error = await res
            .json()
            .catch(() => ({ detail: "ë¡œê·¸ì¸ ì‹¤íŒ¨" }));
          throw new Error(error.detail || "ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }

        const data = await res.json();
        // Store token and nickname in localStorage
        localStorage.setItem("auth_token", data.token);
        localStorage.setItem("user_nickname", data.nickname);
        // Reset welcome mail flag for new login
        localStorage.removeItem("welcome_mail_sent");
        setStatus(`âœ“ ${data.nickname}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`);

        // Redirect after 1.5 seconds
        setTimeout(() => {
          window.location.href = "/";
        }, 1500);
      } catch (err) {
        console.error(err);
        setStatus(err.message || "ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", false);
      }
    });
  })();
</script>
{% endblock %}
