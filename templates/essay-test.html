{% extends "base.html" %} {% block title %}í•œêµ­ì–´ ì‘ë¬¸ í…ŒìŠ¤íŠ¸ | ì˜¤ëˆ„ì´ í•œêµ­ì–´{%
endblock %} {% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
  <div class="text-center mb-8">
    <h1 class="text-4xl font-bold text-gray-900 mb-2">âœï¸ í•œêµ­ì–´ ì‘ë¬¸ í…ŒìŠ¤íŠ¸</h1>
    <p class="text-gray-600">
      AIê°€ ë‹¹ì‹ ì˜ í•œêµ­ì–´ ì‘ë¬¸ì„ ì±„ì í•˜ê³  í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤!
    </p>
  </div>

  <div class="bg-white rounded-2xl shadow-lg p-6">
    <!-- Writing Test Section -->
    <section
      class="mb-6 p-4 bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl border border-yellow-200"
    >
      <h2
        class="text-lg font-semibold mb-4 text-gray-900 flex items-center gap-2"
      >
        <span class="text-2xl">ğŸ“</span>
        ì‘ë¬¸ ì‘ì„±
      </h2>

      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >ì£¼ì œ (ì„ íƒì‚¬í•­)</label
        >
        <input
          id="topic"
          type="text"
          placeholder="ì˜ˆ: ë‚´ê°€ ì¢‹ì•„í•˜ëŠ” ìŒì‹, í•œêµ­ ë¬¸í™”"
          class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-sm"
        />
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >ë‹¹ì‹ ì˜ í•œêµ­ì–´ ì‘ë¬¸ *</label
        >
        <textarea
          id="essayText"
          placeholder="ì—¬ê¸°ì— í•œêµ­ì–´ë¡œ ììœ ë¡­ê²Œ ì‘ë¬¸í•´ì£¼ì„¸ìš”... (ì˜ˆ: ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” í•™ìƒì…ë‹ˆë‹¤. ì €ëŠ” í•œêµ­ì–´ë¥¼ ê³µë¶€í•©ë‹ˆë‹¤.)"
          rows="8"
          class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-sm font-['Pretendard']"
        ></textarea>
        <div class="text-xs text-gray-500 mt-1">
          <span id="charCount">0</span>ì
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >í•™ìŠµ ë ˆë²¨</label
          >
          <select
            id="level"
            class="w-full border border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-yellow-500 text-sm"
          >
            <option value="ì´ˆê¸‰">ì´ˆê¸‰</option>
            <option value="ì¤‘ê¸‰" selected>ì¤‘ê¸‰</option>
            <option value="ê³ ê¸‰">ê³ ê¸‰</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >AI ëª¨ë¸</label
          >
          <select
            id="modelSelect"
            class="w-full border border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-yellow-500 text-sm"
          >
            <option value="gemini-2.5-flash" data-backend="gemini" selected>
              Gemini Flash
            </option>
            <option value="exaone3.5:2.4b" data-backend="ollama">
              EXAONE 3.5
            </option>
          </select>
        </div>
      </div>

      <button
        id="submitBtn"
        onclick="submitEssay()"
        class="w-full bg-gradient-to-r from-yellow-500 to-amber-600 text-white px-6 py-3 rounded-lg transition-all shadow-md font-medium hover:shadow-lg"
      >
        ğŸ¯ ì‘ë¬¸ ì œì¶œ & ì±„ì ë°›ê¸°
      </button>

      <div
        id="feedbackResult"
        class="bg-white p-4 rounded-lg shadow-sm hidden border border-yellow-200 mt-4 max-h-[600px] overflow-y-auto"
      ></div>
    </section>

    <!-- Tips Section -->
    <section class="p-4 bg-blue-50 rounded-xl border border-blue-200">
      <h3 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
        <span>ğŸ’¡</span>
        íŒ
      </h3>
      <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
        <li>
          ìì‹ ì˜ ìˆ˜ì¤€ë³´ë‹¤ ì¡°ê¸ˆ ë†’ì€ ë‚œì´ë„ë¡œ ë„ì „í•˜ë©´ ë” ì¢‹ì€ í”¼ë“œë°±ì„ ë°›ì„ ìˆ˜
          ìˆìŠµë‹ˆë‹¤.
        </li>
        <li>
          ë¬¸ë²• ì˜¤ë¥˜, ë°œìŒ, ë¬¸ì¥ êµ¬ì¡° ë“± ì—¬ëŸ¬ ì¸¡ë©´ì—ì„œ í”¼ë“œë°±ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </li>
        <li>
          ìµœì†Œ 2-3 ë¬¸ì¥ ì´ìƒ ì‘ì„±í•˜ë©´ ë” ìì„¸í•œ í”¼ë“œë°±ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </li>
      </ul>
    </section>
  </div>
</div>

<script>
  const modelSelect = document.getElementById("modelSelect");
  const charCount = document.getElementById("charCount");
  const essayText = document.getElementById("essayText");
  let currentBackend = "gemini";

  // ê¸€ì ìˆ˜ í‘œì‹œ
  essayText.addEventListener("input", function () {
    charCount.textContent = this.value.length;
  });

  // Backend ì„ íƒ ì‹œ ì—…ë°ì´íŠ¸
  modelSelect.addEventListener("change", function () {
    currentBackend =
      this.options[this.selectedIndex].getAttribute("data-backend") || "gemini";
  });

  async function submitEssay() {
    const essay = document.getElementById("essayText").value.trim();
    if (!essay) {
      alert("ì‘ë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
      return;
    }

    const btn = document.getElementById("submitBtn");
    btn.disabled = true;
    btn.innerHTML = "â³ ì±„ì  ì¤‘...";

    try {
      const response = await fetch("/api/correct-essay", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          essay: essay,
          topic: document.getElementById("topic").value,
          level: document.getElementById("level").value,
          backend: currentBackend,
          model: document.getElementById("modelSelect").value,
        }),
      });

      const data = await response.json();
      const outDiv = document.getElementById("feedbackResult");

      if (!response.ok) {
        outDiv.innerHTML = `<div class="text-red-600">ì˜¤ë¥˜: ${
          data.error || "ìš”ì²­ ì‹¤íŒ¨"
        }</div>`;
      } else {
        let html = `<div class="prose max-w-full">`;
        html += `<h3>ğŸ“‹ ì±„ì  ê²°ê³¼</h3>`;
        html += `<div class="bg-yellow-50 p-3 rounded border border-yellow-200 mb-4">`;
        html += `<p><strong>ì›ë¬¸:</strong><br/>${essay}</p>`;
        html += `</div>`;
        html += `<div>${data.feedback || ""}</div>`;
        html += `</div>`;
        outDiv.innerHTML = html;
      }

      outDiv.classList.remove("hidden");
    } catch (error) {
      document.getElementById(
        "feedbackResult"
      ).innerHTML = `<div class="text-red-600">ì˜¤ë¥˜: ${error.message}</div>`;
      document.getElementById("feedbackResult").classList.remove("hidden");
    } finally {
      btn.disabled = false;
      btn.innerHTML = "ğŸ¯ ì‘ë¬¸ ì œì¶œ & ì±„ì ë°›ê¸°";
    }
  }
</script>
{% endblock %}
