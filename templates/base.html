<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}ì˜¤ëˆ„ì´ í•œêµ­ì–´{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg" />
    <link rel="alternate icon" href="/static/favicon.ico" />

    <!-- Pretendard font -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Suppress Tailwind CDN warning in console (development use only)
      if (window.tailwindcss) {
        window.tailwindcss.config = { corePlugins: {} };
      }

      // Suppress storage access errors from browser extensions
      window.addEventListener(
        "error",
        function (event) {
          if (
            event.message &&
            event.message.includes("Access to storage is not allowed")
          ) {
            event.preventDefault();
          }
        },
        true
      );

      // Also suppress unhandled promise rejections for storage errors
      window.addEventListener("unhandledrejection", function (event) {
        if (
          event.reason &&
          event.reason.message &&
          event.reason.message.includes("Access to storage is not allowed")
        ) {
          event.preventDefault();
        }
      });
    </script>

    <style>
      :root {
        --bg1: #ffe7c2;
        --bg2: #ffd6f5;
        --panel: #ffffff;
        --text-main: #22293a;
        --text-sub: #6b7280;
        --accent: #fb923c;
        --accent2: #6366f1;
      }

      html,
      body {
        font-family: "Pretendard", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, "Helvetica Neue", "Noto Sans KR", "Noto Sans", Arial,
          sans-serif;
      }

      body {
        min-height: 100vh;
        background: radial-gradient(circle at 0% 0%, #fff7db, transparent 50%),
          radial-gradient(circle at 100% 100%, #e0e7ff, transparent 50%),
          linear-gradient(135deg, var(--bg1), var(--bg2));
        color: var(--text-main);
      }

      .nav-link {
        transition: all 0.2s ease;
      }

      .nav-link:hover {
        transform: translateY(-2px);
        color: var(--accent);
      }

      .nav-link.active {
        color: var(--accent);
        font-weight: 600;
      }

      .dropdown {
        position: relative;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        background-color: white;
        min-width: 200px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        z-index: 1000;
        margin-top: 0px;
        padding-top: 8px;
      }

      .dropdown:hover .dropdown-content {
        display: block;
      }

      .dropdown-content::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 8px;
        background: transparent;
      }

      .dropdown-content a {
        padding: 12px 16px;
        display: block;
        color: #374151;
        text-decoration: none;
        font-size: 0.875rem;
        transition: background-color 0.2s;
      }

      .dropdown-content a:hover {
        background-color: #fff7ed;
        color: #fb923c;
      }

      .dropdown-content a:first-child {
        border-radius: 8px 8px 0 0;
      }

      .dropdown-content a:last-child {
        border-radius: 0 0 8px 8px;
      }

      .dropdown-content .menu-disabled {
        color: #9ca3af;
        cursor: not-allowed;
      }

      .dropdown-content .menu-disabled:hover {
        background-color: transparent;
        color: #9ca3af;
      }
    </style>

    {% block extra_css %}{% endblock %}
  </head>
  <body class="bg-gray-100">
    <!-- Navigation Header -->
    <nav class="sticky top-0 z-40 bg-white shadow-md">
      <div class="max-w-7xl mx-auto px-2 sm:px-4 lg:px-6">
        <div class="flex justify-between h-14">
          <div class="flex items-center">
            <!-- Logo -->
            <div class="flex-shrink-0 flex items-center">
              <a
                href="/"
                class="text-lg sm:text-2xl font-bold text-orange-500 whitespace-nowrap"
              >
                ğŸŒ¸ ì˜¤ëˆ„ì´ í•œêµ­ì–´
              </a>
            </div>

            <!-- Desktop Navigation -->
            <div
              class="hidden sm:ml-4 lg:ml-6 sm:flex sm:space-x-2 lg:space-x-4"
            >
              <a
                href="/"
                class="nav-link inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-xs sm:text-sm font-medium text-gray-900 whitespace-nowrap"
              >
                ğŸ  í™ˆ
              </a>

              <!-- ë°œìŒ í•™ìŠµ ë“œë¡­ë‹¤ìš´ -->
              <div class="dropdown inline-flex items-center">
                <button
                  class="nav-link inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-900 whitespace-nowrap"
                >
                  ğŸ—£ï¸ ë°œìŒ í•™ìŠµ â–¾
                </button>
                <div class="dropdown-content">
                  <a href="/speechpro-practice">ğŸ¤ ë°œìŒ ì •í™•ë„ í‰ê°€</a>
                  <a href="/fluency-practice">ğŸ—£ï¸ ìœ ì°½ì„± í‰ê°€</a>
                  <a href="/pronunciation-stages">ğŸ“š ë‹¨ê³„ë³„ ë°œìŒ í•™ìŠµ</a>
                  <a href="/pronunciation-rules">ğŸ“– ë°œìŒ ê·œì¹™</a>
                </div>
              </div>

              <!-- AI í•™ìŠµ ë“œë¡­ë‹¤ìš´ -->
              <div class="dropdown inline-flex items-center">
                <button
                  class="nav-link inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-900 whitespace-nowrap"
                >
                  ğŸ¤– AI í•™ìŠµ â–¾
                </button>
                <div class="dropdown-content">
                  <a href="/learning">ğŸ“ AI í•™ìŠµ ë„êµ¬</a>
                  <a href="/content-generation">ğŸ“š ë§ì¶¤í˜• êµì¬</a>
                  <a href="/fluency-test">âœï¸ ì‘ë¬¸ í…ŒìŠ¤íŠ¸</a>
                  <a href="/media-generation">ğŸ¨ ìƒí™©ë³„ ì½˜í…ì¸  ìƒì„±</a>
                </div>
              </div>

              <!-- í™œë™í•˜ê¸° ë“œë¡­ë‹¤ìš´ -->
              <div class="dropdown inline-flex items-center">
                <button
                  class="nav-link inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-900 whitespace-nowrap"
                >
                  ğŸ² í™œë™í•˜ê¸° â–¾
                </button>
                <div class="dropdown-content">
                  <div
                    class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase"
                  >
                    ì¬ë¯¸ìˆëŠ” ë†€ì´
                  </div>
                  <a href="/word-puzzle">ğŸ§© ë‹¨ì–´ ì‚­ì œ</a>
                  <a href="/vocab-garden">ğŸŒŠ ì¡°ì‚¬ ë– ë‹¤ë‹ˆê¸°</a>
                  <a href="/daily-expression">ğŸ’¬ ì˜¤ëŠ˜ì˜ í‘œí˜„</a>
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >ğŸ‘½ ê°¤ëŸ¬ê·¸ (ì¤€ë¹„ì¤‘)</span
                  >
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >ğŸ”¤ ì´ˆì„± í€´ì¦ˆ (ì¤€ë¹„ì¤‘)</span
                  >
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >ğŸƒ ì¹´ë“œ ì§ ë§ì¶”ê¸° (ì¤€ë¹„ì¤‘)</span
                  >
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >ğŸ“‡ ë””ì§€í„¸ ë‹¨ì–´ ì¹´ë“œ (ì¤€ë¹„ì¤‘)</span
                  >
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >âœï¸ ì‹­ì ë§í’€ì´ (ì¤€ë¹„ì¤‘)</span
                  >
                  <div class="border-t border-gray-100 my-1"></div>
                  <div
                    class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase"
                  >
                    ì¬ë¯¸ìˆëŠ” ì´ì•¼ê¸°
                  </div>
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >ğŸ­ ì „ë˜ë™í™” (ì¤€ë¹„ì¤‘)</span
                  >
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >ğŸª ë¯¼ì† ë†€ì´ (ì¤€ë¹„ì¤‘)</span
                  >
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >ğŸ² í•œêµ­ìŒì‹ (ì¤€ë¹„ì¤‘)</span
                  >
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >ğŸš‡ í•œêµ­êµí†µ (ì¤€ë¹„ì¤‘)</span
                  >
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >ğŸ™ í•œêµ­ì˜ˆì ˆ (ì¤€ë¹„ì¤‘)</span
                  >
                </div>
              </div>

              <!-- ë„ì›€ë§ ë“œë¡­ë‹¤ìš´ -->
              <div class="dropdown inline-flex items-center">
                <button
                  class="nav-link inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-900 whitespace-nowrap"
                >
                  ğŸ†˜ ë„ì›€ë§ â–¾
                </button>
                <div class="dropdown-content">
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >â“ Q&A(ìì£¼ë¬»ëŠ”ì§ˆë¬¸) (ì¤€ë¹„ì¤‘)</span
                  >
                  <div class="border-t border-gray-100 my-1"></div>
                  <div
                    class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase"
                  >
                    1:1ë¬¸ì˜ ì±„ë„
                  </div>
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >ğŸ’¬ ê²Œì‹œíŒ ë¬¸ì˜ (ì¤€ë¹„ì¤‘)</span
                  >
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >âœ‰ï¸ ì´ë©”ì¼ ë°œì†¡ (ì¤€ë¹„ì¤‘)</span
                  >
                  <span class="menu-disabled block px-4 py-3 text-xs"
                    >ğŸ“ ì „í™” ìƒë‹´ (ì¤€ë¹„ì¤‘)</span
                  >
                </div>
              </div>

              <a
                href="/api-test"
                class="nav-link inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-900 whitespace-nowrap"
              >
                ğŸ”§ API í…ŒìŠ¤íŠ¸
              </a>

              <a
                href="/sitemap"
                class="nav-link inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-900 whitespace-nowrap"
              >
                ğŸ“ ì‚¬ì´íŠ¸ë§µ
              </a>
            </div>
          </div>

          <!-- Auth Links (Desktop) -->
          <div class="flex items-center space-x-2 sm:space-x-3">
            <a
              href="/learning-progress"
              id="progress-link"
              class="px-2 sm:px-3 py-2 text-xs sm:text-sm font-medium text-gray-600 hover:text-gray-900 whitespace-nowrap"
              style="display: none"
            >
              ğŸ“Š í•™ìŠµ ì§„ë„
            </a>
            <a
              href="/mypage"
              id="mypage-link"
              class="px-2 sm:px-3 py-2 text-xs sm:text-sm font-medium text-gray-600 hover:text-gray-900 whitespace-nowrap"
              style="display: none"
            >
              ë‚´ í”„ë¡œí•„
            </a>
            <span
              id="user-display"
              class="text-xs sm:text-sm text-gray-600"
              style="display: none"
            ></span>
            <button
              id="logout-btn"
              class="px-2 sm:px-3 py-2 text-xs sm:text-sm font-medium text-gray-600 hover:text-gray-900"
              style="display: none"
            >
              ë¡œê·¸ì•„ì›ƒ
            </button>
            <a
              href="/login"
              id="login-link"
              class="px-2 sm:px-4 py-2 rounded-lg bg-orange-500 text-white text-xs sm:text-sm font-medium hover:bg-orange-600 whitespace-nowrap"
            >
              ë¡œê·¸ì¸
            </a>
          </div>
        </div>
      </div>

      <!-- Mobile menu (hidden by default) -->
      <div class="sm:hidden" id="mobile-menu" style="display: none">
        <div class="pt-2 pb-3 space-y-1">
          <a
            href="/"
            class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-600 hover:bg-gray-50 hover:border-orange-500 hover:text-gray-800"
          >
            ğŸ  í™ˆ
          </a>

          <!-- ë°œìŒ í•™ìŠµ -->
          <div class="pl-3 pr-4 py-2">
            <div class="text-sm font-semibold text-gray-900 mb-1">
              ğŸ—£ï¸ ë°œìŒ í•™ìŠµ
            </div>
            <a
              href="/speechpro-practice"
              class="block pl-4 py-1 text-sm text-gray-600"
              >ğŸ¤ ë°œìŒ ì •í™•ë„ í‰ê°€</a
            >
            <a
              href="/fluency-practice"
              class="block pl-4 py-1 text-sm text-gray-600"
              >ğŸ—£ï¸ ìœ ì°½ì„± í‰ê°€</a
            >
            <a
              href="/pronunciation-stages"
              class="block pl-4 py-1 text-sm text-gray-600"
              >ğŸ“š ë‹¨ê³„ë³„ ë°œìŒ í•™ìŠµ</a
            >
            <a
              href="/pronunciation-rules"
              class="block pl-4 py-1 text-sm text-gray-600"
              >ğŸ“– ë°œìŒ ê·œì¹™</a
            >
          </div>

          <!-- AI í•™ìŠµ -->
          <div class="pl-3 pr-4 py-2">
            <div class="text-sm font-semibold text-gray-900 mb-1">
              ğŸ¤– AI í•™ìŠµ
            </div>
            <a href="/learning" class="block pl-4 py-1 text-sm text-gray-600"
              >ğŸ“ AI í•™ìŠµ ë„êµ¬</a
            >
            <a
              href="/content-generation"
              class="block pl-4 py-1 text-sm text-gray-600"
              >ğŸ“š ë§ì¶¤í˜• êµì¬</a
            >
            <a
              href="/fluency-test"
              class="block pl-4 py-1 text-sm text-gray-600"
              >âœï¸ ì‘ë¬¸ í…ŒìŠ¤íŠ¸</a
            >
            <a
              href="/media-generation"
              class="block pl-4 py-1 text-sm text-gray-600"
              >ğŸ¨ ìƒí™©ë³„ ì½˜í…ì¸  ìƒì„±</a
            >
          </div>

          <!-- í™œë™í•˜ê¸° -->
          <div class="pl-3 pr-4 py-2">
            <div class="text-sm font-semibold text-gray-900 mb-1">
              ğŸ² í™œë™í•˜ê¸°
            </div>
            <div class="pl-2 py-1">
              <div class="text-xs font-semibold text-gray-700 mb-1">
                ì¬ë¯¸ìˆëŠ” ë†€ì´
              </div>
              <a
                href="/word-puzzle"
                class="block pl-4 py-1 text-sm text-gray-600"
                >ğŸ§© ë‹¨ì–´ ì‚­ì œ</a
              >
              <a
                href="/vocab-garden"
                class="block pl-4 py-1 text-sm text-gray-600"
                >ğŸŒŠ ì¡°ì‚¬ ë– ë‹¤ë‹ˆê¸°</a
              >
              <a
                href="/daily-expression"
                class="block pl-4 py-1 text-sm text-gray-600"
                >ğŸ’¬ ì˜¤ëŠ˜ì˜ í‘œí˜„</a
              >
              <span class="block pl-4 py-1 text-sm text-gray-400"
                >ğŸ‘½ ê°¤ëŸ¬ê·¸ (ì¤€ë¹„ì¤‘)</span
              >
              <span class="block pl-4 py-1 text-sm text-gray-400"
                >ğŸ”¤ ì´ˆì„± í€´ì¦ˆ (ì¤€ë¹„ì¤‘)</span
              >
              <span class="block pl-4 py-1 text-sm text-gray-400"
                >ğŸƒ ì¹´ë“œ ì§ ë§ì¶”ê¸° (ì¤€ë¹„ì¤‘)</span
              >
              <span class="block pl-4 py-1 text-sm text-gray-400"
                >ğŸ“‡ ë””ì§€í„¸ ë‹¨ì–´ ì¹´ë“œ (ì¤€ë¹„ì¤‘)</span
              >
              <span class="block pl-4 py-1 text-sm text-gray-400"
                >âœï¸ ì‹­ì ë§í’€ì´ (ì¤€ë¹„ì¤‘)</span
              >
            </div>
            <div class="pl-2 py-1 mt-2">
              <div class="text-xs font-semibold text-gray-700 mb-1">
                ì¬ë¯¸ìˆëŠ” ì´ì•¼ê¸°
              </div>
              <span class="block pl-4 py-1 text-sm text-gray-400"
                >ğŸ­ ì „ë˜ë™í™” (ì¤€ë¹„ì¤‘)</span
              >
              <span class="block pl-4 py-1 text-sm text-gray-400"
                >ğŸª ë¯¼ì† ë†€ì´ (ì¤€ë¹„ì¤‘)</span
              >
              <span class="block pl-4 py-1 text-sm text-gray-400"
                >ğŸ² í•œêµ­ìŒì‹ (ì¤€ë¹„ì¤‘)</span
              >
              <span class="block pl-4 py-1 text-sm text-gray-400"
                >ğŸš‡ í•œêµ­êµí†µ (ì¤€ë¹„ì¤‘)</span
              >
              <span class="block pl-4 py-1 text-sm text-gray-400"
                >ğŸ™ í•œêµ­ì˜ˆì ˆ (ì¤€ë¹„ì¤‘)</span
              >
            </div>
          </div>

          <!-- ë„ì›€ë§ -->
          <div class="pl-3 pr-4 py-2">
            <div class="text-sm font-semibold text-gray-900 mb-1">
              ğŸ†˜ ë„ì›€ë§
            </div>
            <span class="block pl-4 py-1 text-sm text-gray-400"
              >â“ Q&A(ìì£¼ë¬»ëŠ”ì§ˆë¬¸) (ì¤€ë¹„ì¤‘)</span
            >
            <div class="pl-2 py-1 mt-2">
              <div class="text-xs font-semibold text-gray-700 mb-1">
                1:1ë¬¸ì˜ ì±„ë„
              </div>
              <span class="block pl-4 py-1 text-sm text-gray-400"
                >ğŸ’¬ ê²Œì‹œíŒ ë¬¸ì˜ (ì¤€ë¹„ì¤‘)</span
              >
              <span class="block pl-4 py-1 text-sm text-gray-400"
                >âœ‰ï¸ ì´ë©”ì¼ ë°œì†¡ (ì¤€ë¹„ì¤‘)</span
              >
              <span class="block pl-4 py-1 text-sm text-gray-400"
                >ğŸ“ ì „í™” ìƒë‹´ (ì¤€ë¹„ì¤‘)</span
              >
            </div>
          </div>

          <a
            href="/api-test"
            class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-600 hover:bg-gray-50 hover:border-orange-500 hover:text-gray-800"
          >
            ğŸ”§ API í…ŒìŠ¤íŠ¸
          </a>

          <a
            href="/sitemap"
            class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-600 hover:bg-gray-50 hover:border-orange-500 hover:text-gray-800"
          >
            ğŸ“ ì‚¬ì´íŠ¸ë§µ
          </a>

          <!-- User Menu Mobile -->
          <div
            class="border-t border-gray-200 pt-2 mt-2"
            id="mobile-user-menu"
            style="display: none"
          >
            <a
              href="/learning-progress"
              class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-600 hover:bg-gray-50 hover:border-orange-500 hover:text-gray-800"
            >
              ğŸ“Š í•™ìŠµ ì§„ë„
            </a>
            <a
              href="/mypage"
              class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-600 hover:bg-gray-50 hover:border-orange-500 hover:text-gray-800"
            >
              ğŸ‘¤ ë‚´ í”„ë¡œí•„
            </a>
            <button
              id="mobile-logout-btn"
              class="block w-full text-left pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-600 hover:bg-gray-50 hover:border-orange-500 hover:text-gray-800"
              style="display: none"
            >
              ë¡œê·¸ì•„ì›ƒ
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="py-6">{% block content %}{% endblock %}</main>

    <!-- Floating Chatbot Button -->
    <div id="chatbot-widget" class="fixed bottom-6 right-6 z-50">
      <!-- Chat Button -->
      <button
        id="chatbot-toggle"
        class="w-16 h-16 rounded-full bg-gradient-to-br from-orange-500 to-pink-500 text-white shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center group hover:scale-110"
      >
        <svg
          class="w-8 h-8"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
          ></path>
        </svg>
      </button>

      <!-- Chat Window -->
      <div
        id="chatbot-window"
        class="hidden absolute bottom-20 right-0 w-96 h-[500px] bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden"
        style="max-width: calc(100vw - 2rem)"
      >
        <!-- Header -->
        <div
          class="bg-gradient-to-r from-orange-500 to-pink-500 text-white p-4 flex items-center justify-between"
        >
          <div class="flex items-center space-x-2">
            <div
              class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center font-bold"
            >
              AI
            </div>
            <div>
              <div class="font-semibold">AI í•œêµ­ì–´ íŠœí„°</div>
              <div class="text-xs opacity-90">ì˜¨ë¼ì¸</div>
            </div>
          </div>
          <button
            id="chatbot-close"
            class="text-white hover:bg-white/20 rounded-full p-1"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>

        <!-- Messages -->
        <div
          id="chatbot-messages"
          class="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50"
        >
          <div class="flex items-start space-x-2">
            <div
              class="w-8 h-8 rounded-full bg-gradient-to-br from-orange-400 to-pink-400 flex items-center justify-center text-white text-xs font-bold flex-shrink-0"
            >
              AI
            </div>
            <div
              class="bg-white rounded-lg rounded-tl-sm p-3 shadow-sm max-w-[80%]"
            >
              <p class="text-sm text-gray-800">
                ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹<br />í•œêµ­ì–´ í•™ìŠµì„ ë„ì™€ë“œë¦´ê²Œìš”.<br />ê¶ê¸ˆí•œ ì ì„
                ë¬¼ì–´ë³´ì„¸ìš”!
              </p>
            </div>
          </div>
        </div>

        <!-- Input -->
        <div class="border-t border-gray-200 p-3 bg-white">
          <div class="flex space-x-2">
            <input
              type="text"
              id="chatbot-input"
              placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
              class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-orange-500"
              autocomplete="off"
            />
            <button
              id="chatbot-send"
              class="px-4 py-2 bg-gradient-to-r from-orange-500 to-pink-500 text-white text-sm font-medium rounded-full hover:from-orange-600 hover:to-pink-600 focus:outline-none disabled:opacity-50"
            >
              ì „ì†¡
            </button>
          </div>
        </div>
      </div>
    </div>

    <style>
      #chatbot-messages::-webkit-scrollbar {
        width: 6px;
      }

      #chatbot-messages::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }

      #chatbot-messages::-webkit-scrollbar-thumb {
        background: #fb923c;
        border-radius: 10px;
      }

      .chatbot-typing {
        display: inline-flex;
        gap: 4px;
      }

      .chatbot-typing span {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background-color: #fb923c;
        animation: typing 1.4s infinite;
      }

      .chatbot-typing span:nth-child(2) {
        animation-delay: 0.2s;
      }

      .chatbot-typing span:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typing {
        0%,
        60%,
        100% {
          transform: translateY(0);
        }
        30% {
          transform: translateY(-8px);
        }
      }

      @media (max-width: 640px) {
        #chatbot-window {
          width: calc(100vw - 2rem);
          right: 1rem;
        }
      }
    </style>

    <script>
      // Chatbot Widget
      const chatbotToggle = document.getElementById("chatbot-toggle");
      const chatbotWindow = document.getElementById("chatbot-window");
      const chatbotClose = document.getElementById("chatbot-close");
      const chatbotMessages = document.getElementById("chatbot-messages");
      const chatbotInput = document.getElementById("chatbot-input");
      const chatbotSend = document.getElementById("chatbot-send");

      // Toggle chat window
      chatbotToggle.addEventListener("click", () => {
        chatbotWindow.classList.toggle("hidden");
        if (!chatbotWindow.classList.contains("hidden")) {
          chatbotInput.focus();
        }
      });

      chatbotClose.addEventListener("click", () => {
        chatbotWindow.classList.add("hidden");
      });

      // Add user message
      function addChatbotUserMessage(text) {
        const messageDiv = document.createElement("div");
        messageDiv.className = "flex items-start space-x-2 justify-end";
        messageDiv.innerHTML = `
          <div class="bg-gradient-to-br from-orange-500 to-pink-500 rounded-lg rounded-tr-sm p-3 shadow-sm max-w-[80%]">
            <p class="text-sm text-white">${escapeHtml(text)}</p>
          </div>
        `;
        chatbotMessages.appendChild(messageDiv);
        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
      }

      // Add AI message
      function addChatbotAIMessage(text) {
        const messageDiv = document.createElement("div");
        messageDiv.className = "flex items-start space-x-2";
        messageDiv.innerHTML = `
          <div class="w-8 h-8 rounded-full bg-gradient-to-br from-orange-400 to-pink-400 flex items-center justify-center text-white text-xs font-bold flex-shrink-0">
            AI
          </div>
          <div class="bg-white rounded-lg rounded-tl-sm p-3 shadow-sm max-w-[80%]">
            <p class="text-sm text-gray-800">${escapeHtml(text).replace(
              /\n/g,
              "<br>"
            )}</p>
          </div>
        `;
        chatbotMessages.appendChild(messageDiv);
        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
      }

      // Add typing indicator
      function addChatbotTyping() {
        const typingDiv = document.createElement("div");
        typingDiv.id = "chatbot-typing-indicator";
        typingDiv.className = "flex items-start space-x-2";
        typingDiv.innerHTML = `
          <div class="w-8 h-8 rounded-full bg-gradient-to-br from-orange-400 to-pink-400 flex items-center justify-center text-white text-xs font-bold flex-shrink-0">
            AI
          </div>
          <div class="bg-white rounded-lg rounded-tl-sm p-3 shadow-sm">
            <div class="chatbot-typing">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        `;
        chatbotMessages.appendChild(typingDiv);
        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
      }

      // Remove typing indicator
      function removeChatbotTyping() {
        const typingDiv = document.getElementById("chatbot-typing-indicator");
        if (typingDiv) {
          typingDiv.remove();
        }
      }

      // Escape HTML
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Send message
      async function sendChatbotMessage(message) {
        if (!message.trim()) return;

        addChatbotUserMessage(message);
        chatbotInput.value = "";
        chatbotSend.disabled = true;

        addChatbotTyping();

        try {
          const response = await fetch("/api/chatbot", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ message: message }),
          });

          const data = await response.json();
          removeChatbotTyping();

          if (response.ok) {
            addChatbotAIMessage(data.response);
          } else {
            addChatbotAIMessage("ì£„ì†¡í•©ë‹ˆë‹¤. ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (error) {
          console.error("Error:", error);
          removeChatbotTyping();
          addChatbotAIMessage("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        } finally {
          chatbotSend.disabled = false;
          chatbotInput.focus();
        }
      }

      // Event listeners
      chatbotSend.addEventListener("click", () => {
        sendChatbotMessage(chatbotInput.value);
      });

      chatbotInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          sendChatbotMessage(chatbotInput.value);
        }
      });
    </script>

    <!-- Footer -->
    <footer class="bg-white mt-12 py-6 border-t border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center text-sm text-gray-500">
          <span>Â© 2025 ì˜¤ëˆ„ì´ í•œêµ­ì–´ í•™ìŠµ í”Œë«í¼</span>
          <span>Powered by FastAPI + AI</span>
        </div>
      </div>
    </footer>

    <script>
      // Mobile menu toggle
      const mobileMenuButton = document.createElement("button");
      mobileMenuButton.className =
        "sm:hidden inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100";
      mobileMenuButton.innerHTML = `
      <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    `;

      // Add menu button to nav (this would need proper positioning in production)
      mobileMenuButton.addEventListener("click", () => {
        const menu = document.getElementById("mobile-menu");
        menu.style.display = menu.style.display === "none" ? "block" : "none";
      });

      // Prepend the mobile menu button into the header for small screens
      const headerFlex = document.querySelector("nav .flex");
      if (headerFlex) {
        headerFlex.prepend(mobileMenuButton);
      }

      // Set active state on navigation links by matching current path
      function setActiveNav() {
        const rawPath = window.location.pathname || "/";
        const path = rawPath.replace(/\/$/, "") || "/";
        document.querySelectorAll("nav a").forEach((a) => {
          const href = (a.getAttribute("href") || "").replace(/\/$/, "") || "/";
          if (href === path) {
            a.classList.add("active", "font-semibold", "text-orange-500");
          } else {
            a.classList.remove("active", "font-semibold", "text-orange-500");
          }
        });
      }

      // Update auth display
      function updateAuthDisplay() {
        const token = localStorage.getItem("auth_token");
        const nickname = localStorage.getItem("user_nickname");
        const loginLink = document.getElementById("login-link");
        const progressLink = document.getElementById("progress-link");
        const mypageLink = document.getElementById("mypage-link");
        const userDisplay = document.getElementById("user-display");
        const logoutBtn = document.getElementById("logout-btn");
        const mobileUserMenu = document.getElementById("mobile-user-menu");
        const mobileLinkoutBtn = document.getElementById("mobile-logout-btn");

        if (token && nickname) {
          if (loginLink) loginLink.style.display = "none";
          if (progressLink) progressLink.style.display = "inline-block";
          if (mypageLink) mypageLink.style.display = "inline-block";
          if (userDisplay) {
            userDisplay.textContent = `ğŸ‘¤ ${nickname}`;
            userDisplay.style.display = "inline";
          }
          if (logoutBtn) {
            logoutBtn.style.display = "inline-block";
            logoutBtn.addEventListener("click", handleLogout);
          }
          if (mobileUserMenu) mobileUserMenu.style.display = "block";
          if (mobileLinkoutBtn) {
            mobileLinkoutBtn.style.display = "block";
            mobileLinkoutBtn.addEventListener("click", handleLogout);
          }
        } else {
          if (loginLink) loginLink.style.display = "inline-block";
          if (progressLink) progressLink.style.display = "none";
          if (mypageLink) mypageLink.style.display = "none";
          if (userDisplay) userDisplay.style.display = "none";
          if (logoutBtn) logoutBtn.style.display = "none";
          if (mobileUserMenu) mobileUserMenu.style.display = "none";
          if (mobileLinkoutBtn) mobileLinkoutBtn.style.display = "none";
        }
      }

      function handleLogout() {
        localStorage.removeItem("auth_token");
        localStorage.removeItem("user_nickname");
        updateAuthDisplay();
        window.location.href = "/";
      }

      // Run on load
      setActiveNav();
      updateAuthDisplay();
    </script>

    {% block extra_js %}{% endblock %}
  </body>
</html>
