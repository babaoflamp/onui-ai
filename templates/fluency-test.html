{% extends "base.html" %} {% block title %}í•œêµ­ì–´ ì‘ë¬¸ í…ŒìŠ¤íŠ¸ - ì˜¤ëˆ„ì´ í•œêµ­ì–´{%
endblock %} {% block content %}
<div class="max-w-4xl mx-auto px-4">
  <div class="bg-white rounded-2xl p-6 shadow-lg">
    <!-- Header -->
    <header class="mb-6">
      <div
        class="inline-flex items-center gap-2 px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-semibold mb-2"
      >
        <span class="w-2 h-2 bg-green-500 rounded-full"></span>
        ONUI Â· AI í•™ìŠµ ë„êµ¬
      </div>
      <h1 class="text-3xl font-bold text-gray-900 mb-2">
        <span class="text-2xl">âœï¸</span>
        í•œêµ­ì–´ ì‘ë¬¸ í…ŒìŠ¤íŠ¸
      </h1>
      <p class="text-sm text-gray-600">
        ììœ ë¡­ê²Œ í•œêµ­ì–´ë¡œ ê¸€ì„ ì“°ê³  AIê°€ í‰ê°€í•©ë‹ˆë‹¤
      </p>
    </header>

    <!-- Writing Test Section -->
    <section
      class="mb-6 p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl border border-green-200"
    >
      <h2
        class="text-lg font-semibold mb-3 text-gray-900 flex items-center gap-2"
      >
        <span class="text-2xl">ğŸ“</span>
        ê¸€ ì‘ì„±
      </h2>

      <div class="bg-white p-4 rounded-lg shadow-sm">
        <label
          for="fluencyInput"
          class="text-sm font-semibold text-gray-700 mb-2 block"
        >
          ì£¼ì œ: ì˜¤ëŠ˜ ê¸°ë¶„ì´ë‚˜ ê²½í—˜í•œ ì¼ì„ ììœ ë¡­ê²Œ í•œêµ­ì–´ë¡œ ì¨ë³´ì„¸ìš”
        </label>

        <textarea
          id="fluencyInput"
          placeholder="ì˜ˆì‹œ:
ì˜¤ëŠ˜ì€ ë‚ ì”¨ê°€ ì •ë§ ì¢‹ì•˜ì–´ìš”. ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ê³µì›ì— ê°”ë‹¤. ìš°ë¦¬ëŠ” ì»¤í”¼ë¥¼ ë§ˆì‹œê³  ì¬ë¯¸ìˆëŠ” ì´ì•¼ê¸°ë“¤ì„ ë‚˜ëˆ„ì—ˆìŠµë‹ˆë‹¤. ì •ë§ í–‰ë³µí•œ í•˜ë£¨ì˜€ì–´ìš”!"
          class="w-full border border-gray-300 p-3 rounded-lg mb-4 h-32 focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none text-sm"
        ></textarea>

        <div class="flex gap-2 mb-4">
          <div class="flex-1 p-3 bg-gray-50 rounded-lg">
            <p class="text-xs text-gray-600 mb-1">ê¸€ì ìˆ˜:</p>
            <p id="charCount" class="text-lg font-bold text-gray-900">0</p>
          </div>
          <button
            onclick="checkFluency()"
            class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-4 py-3 rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all shadow-md hover:shadow-lg font-medium"
          >
            ğŸ“Š ì œì¶œ ë° ì±„ì 
          </button>
        </div>

        <div
          id="fluencyResult"
          class="mt-3 p-4 rounded-lg bg-white hidden border border-gray-200 shadow-sm"
        ></div>
      </div>
    </section>

    <!-- Examples Section -->
    <section class="mb-6 p-4 bg-blue-50 rounded-xl border border-blue-200">
      <h2
        class="text-lg font-semibold mb-3 text-gray-900 flex items-center gap-2"
      >
        <span class="text-2xl">ğŸ’¡</span>
        ì‘ë¬¸ íŒ
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-white p-3 rounded-lg">
          <p class="text-sm font-semibold text-gray-900 mb-2">âœ… ì¢‹ì€ ì˜ˆì‹œ</p>
          <p class="text-xs text-gray-700 leading-relaxed">
            ì˜¤ëŠ˜ì€ ë‚ ì”¨ê°€ ì •ë§ ì¢‹ì•˜ì–´ìš”. ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ê³µì›ì— ê°”ìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ”
            ë§›ìˆëŠ” ì»¤í”¼ë¥¼ ë§ˆì‹œë©´ì„œ ì¦ê±°ìš´ ì‹œê°„ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.
          </p>
        </div>
        <div class="bg-white p-3 rounded-lg">
          <p class="text-sm font-semibold text-gray-900 mb-2">
            âš ï¸ ê°œì„ ì´ í•„ìš”í•œ ì˜ˆì‹œ
          </p>
          <p class="text-xs text-gray-700 leading-relaxed">
            ì˜¤ëŠ˜ì€ ì¢‹ë‹¤. ì¹œêµ¬í•˜ê³  ê³µì› ê°”ë‹¤. ì»¤í”¼ ë§ˆì…¨ë‹¤. ì¦ê±°ì› ë‹¤.
          </p>
        </div>
      </div>
    </section>

    <!-- Tips Section -->
    <section class="p-4 bg-gray-50 rounded-xl border border-gray-200">
      <div class="text-sm font-semibold text-gray-900 mb-2">ğŸ’¡ ì±„ì  ê¸°ì¤€</div>
      <div class="text-xs text-gray-700 space-y-1">
        <p>â€¢ <strong>ë¬¸ë²•</strong>: ì˜¬ë°”ë¥¸ í•œêµ­ì–´ ë¬¸ë²• ì‚¬ìš©</p>
        <p>â€¢ <strong>ìì—°ìŠ¤ëŸ¬ì›€</strong>: ì‹¤ì œ ì‚¬ìš©ë˜ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„</p>
        <p>â€¢ <strong>ì–´íœ˜</strong>: ì ì ˆí•œ ë‹¨ì–´ ì„ íƒ</p>
        <p>â€¢ <strong>ì¼ê´€ì„±</strong>: ê¸€ì˜ íë¦„ê³¼ ì¼ê´€ëœ ë‚´ìš©</p>
        <p>â€¢ <strong>í’ë¶€í•¨</strong>: ë‹¤ì–‘í•œ í‘œí˜„ê³¼ ë¬¸ì¥ êµ¬ì¡°ì˜ ì‚¬ìš©</p>
      </div>
    </section>
  </div>
</div>

<script>
  // Update character count
  document
    .getElementById("fluencyInput")
    .addEventListener("input", function () {
      document.getElementById("charCount").textContent = this.value.length;
    });

  // Fluency check
  async function checkFluency() {
    const text = document.getElementById("fluencyInput").value;

    if (!text.trim()) {
      alert("ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    const resultDiv = document.getElementById("fluencyResult");
    resultDiv.classList.remove("hidden");
    resultDiv.innerHTML =
      '<div class="flex items-center gap-3"><div class="animate-spin rounded-full h-5 w-5 border-b-2 border-green-600"></div><span class="text-sm text-gray-600">AIê°€ ì±„ì  ì¤‘ì…ë‹ˆë‹¤...</span></div>';

    const formData = new FormData();
    formData.append("user_text", text);

    try {
      const res = await fetch("/api/fluency-check", {
        method: "POST",
        body: formData,
      });
      const json = await res.json();

      if (json.error) {
        resultDiv.innerHTML = `
          <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
            <p class="text-red-700 font-semibold text-sm">âš ï¸ ì˜¤ë¥˜</p>
            <p class="text-red-600 text-xs mt-1">${json.error}</p>
          </div>
        `;
      } else {
        const score = json.score || 0;
        const scoreColor = score > 80 ? "green" : score > 60 ? "yellow" : "red";

        resultDiv.innerHTML = `
          <div class="space-y-3">
            <!-- Score Card -->
            <div class="p-4 bg-${scoreColor}-50 border border-${scoreColor}-200 rounded-lg">
              <p class="text-xs text-gray-600 mb-2">ìµœì¢… ì ìˆ˜</p>
              <p class="text-4xl font-bold text-${scoreColor}-700">${score}ì </p>
              <div class="mt-3 w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                <div
                  class="bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 h-full transition-all duration-500"
                  style="width: ${score}%"
                ></div>
              </div>
            </div>

            <!-- Feedback -->
            ${
              json.feedback
                ? `<div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                  <p class="text-xs text-gray-600 mb-2">ğŸ“ í”¼ë“œë°±</p>
                  <p class="text-sm text-gray-900">${json.feedback}</p>
                </div>`
                : ""
            }

            <!-- Corrected Text -->
            ${
              json.corrected
                ? `<div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                  <p class="text-xs text-gray-600 mb-2">âœ… êµì •ëœ ë¬¸ì¥</p>
                  <p class="text-sm text-green-900 font-medium">${json.corrected}</p>
                </div>`
                : ""
            }

            <!-- Detailed Analysis -->
            ${
              json.details
                ? `<div class="p-3 bg-gray-50 border border-gray-200 rounded-lg">
                  <p class="text-xs text-gray-600 mb-2">ğŸ“Š ìƒì„¸ ë¶„ì„</p>
                  <p class="text-sm text-gray-900 whitespace-pre-wrap">${json.details}</p>
                </div>`
                : ""
            }
          </div>
        `;
      }
    } catch (error) {
      resultDiv.innerHTML = `
        <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
          <p class="text-red-700 font-semibold text-sm">âš ï¸ ì˜¤ë¥˜</p>
          <p class="text-red-600 text-xs mt-1">ì±„ì  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}</p>
        </div>
      `;
    }
  }

  // Allow Enter+Ctrl to submit
  document
    .getElementById("fluencyInput")
    .addEventListener("keydown", function (e) {
      if (e.ctrlKey && e.key === "Enter") {
        checkFluency();
      }
    });
</script>
{% endblock %}
