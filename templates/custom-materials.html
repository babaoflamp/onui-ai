{% extends "base.html" %} {% block title %}ë§ì¶¤í˜• êµì¬ ìƒì„± | ì˜¤ëˆ„ì´ í•œêµ­ì–´{%
endblock %} {% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
  <div class="text-center mb-8">
    <h1 class="text-4xl font-bold text-gray-900 mb-2">ğŸ“š ë§ì¶¤í˜• êµì¬ ìƒì„±</h1>
    <p class="text-gray-600">
      ë‹¹ì‹ ì˜ ê´€ì‹¬ ì£¼ì œì™€ ë ˆë²¨ì— ë§ëŠ” í•œêµ­ì–´ êµì¬ë¥¼ AIê°€ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤!
    </p>
  </div>

  <div class="bg-white rounded-2xl shadow-lg p-6">
    <!-- Content Generation Section -->
    <section
      class="mb-6 p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-200"
    >
      <h2
        class="text-lg font-semibold mb-4 text-gray-900 flex items-center gap-2"
      >
        <span class="text-2xl">ğŸ¯</span>
        êµì¬ ìƒì„± ì˜µì…˜
      </h2>

      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 mb-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >ê´€ì‹¬ ì£¼ì œ</label
          >
          <input
            id="topic"
            type="text"
            placeholder="ì˜ˆ: ê¹€ì¹˜, í•œêµ­ ì—¬í–‰, í•œêµ­ ì˜í™”"
            value="ê¹€ì¹˜"
            class="w-full border border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
            onkeydown="if (event.key === 'Enter') { event.preventDefault(); if (document.getElementById('topic').value.trim()) generateContent(); }"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >í•™ìŠµ ë ˆë²¨</label
          >
          <select
            id="level"
            class="w-full border border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"
          >
            <option value="ì´ˆê¸‰">ì´ˆê¸‰</option>
            <option value="ì¤‘ê¸‰" selected>ì¤‘ê¸‰</option>
            <option value="ê³ ê¸‰">ê³ ê¸‰</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >AI ëª¨ë¸</label
          >
          <select
            id="modelSelect"
            class="w-full border border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"
          >
            <option value="gemini-2.5-flash" data-backend="gemini" selected>
              Gemini Flash
            </option>
            <option value="exaone3.5:2.4b" data-backend="ollama">
              EXAONE 3.5
            </option>
          </select>
        </div>
      </div>

      <button
        id="generateBtn"
        onclick="toggleGeneration()"
        class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-3 rounded-lg transition-all shadow-md font-medium hover:shadow-lg"
      >
        ğŸª„ êµì¬ ìƒì„±í•˜ê¸°
      </button>

      <div
        id="contentResult"
        class="bg-white p-4 rounded-lg shadow-sm hidden border border-gray-200 mt-4 max-h-[600px] overflow-y-auto"
      ></div>

      <!-- AIì™€ ëŒ€í™” ì„¹ì…˜ -->
      <div class="mt-6 pt-6 border-t border-blue-200">
        <h3
          class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2"
        >
          ğŸ’¬ ìƒì„±ëœ êµì¬ì— ëŒ€í•´ AIì™€ ëŒ€í™”í•˜ê¸°
        </h3>
        <div class="flex gap-2">
          <input
            id="testPrompt"
            type="text"
            class="flex-1 border border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"
            placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."
            onkeydown="if (event.key === 'Enter') { event.preventDefault(); testModel(); }"
          />
          <button
            onclick="testModel()"
            class="bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition-colors text-sm font-medium"
          >
            âœ¨ ë¬¼ì–´ë³´ê¸°
          </button>
        </div>
        <div
          id="modelTestResult"
          class="mt-3 p-3 bg-gray-50 rounded-lg text-sm hidden prose max-w-full border border-gray-200"
        ></div>
      </div>
    </section>
  </div>
</div>

<script>
  // ê¸°ì¡´ learning.htmlì˜ JavaScript í•¨ìˆ˜ë“¤ì„ ë³µì‚¬
  const modelSelect = document.getElementById("modelSelect");
  let currentBackend = "gemini";

  // Backend ì„ íƒ ì‹œ ì—…ë°ì´íŠ¸
  modelSelect.addEventListener("change", function () {
    currentBackend =
      this.options[this.selectedIndex].getAttribute("data-backend") || "gemini";
  });

  async function toggleGeneration() {
    const topic = document.getElementById("topic").value.trim();
    if (!topic) {
      alert("ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
      return;
    }

    const btn = document.getElementById("generateBtn");
    btn.disabled = true;
    btn.innerHTML = "â³ ìƒì„± ì¤‘...";

    try {
      const response = await fetch("/api/generate-content", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          topic: topic,
          level: document.getElementById("level").value,
          backend: currentBackend,
          model: document.getElementById("modelSelect").value,
        }),
      });

      const data = await response.json();
      const outDiv = document.getElementById("contentResult");

      if (!response.ok) {
        outDiv.innerHTML = `<div class="text-red-600">ì˜¤ë¥˜: ${
          data.error || "ìš”ì²­ ì‹¤íŒ¨"
        }</div>`;
      } else {
        let html = `<div class="prose max-w-full">`;
        html += `<h3>${data.title || "ìƒì„±ëœ êµì¬"}</h3>`;
        html += `<p><strong>ì£¼ì œ:</strong> ${data.topic}</p>`;
        html += `<p><strong>ë ˆë²¨:</strong> ${data.level}</p>`;
        html += `<div>${data.content || ""}</div>`;
        html += `</div>`;
        outDiv.innerHTML = html;
      }

      outDiv.classList.remove("hidden");
    } catch (error) {
      document.getElementById(
        "contentResult"
      ).innerHTML = `<div class="text-red-600">ì˜¤ë¥˜: ${error.message}</div>`;
      document.getElementById("contentResult").classList.remove("hidden");
    } finally {
      btn.disabled = false;
      btn.innerHTML = "ğŸª„ êµì¬ ìƒì„±í•˜ê¸°";
    }
  }

  async function testModel() {
    const prompt = document.getElementById("testPrompt").value.trim();
    if (!prompt) return;

    const outDiv = document.getElementById("modelTestResult");
    outDiv.innerHTML = "â³ ì‘ë‹µ ì¤‘...";
    outDiv.classList.remove("hidden");

    try {
      const response = await fetch("/api/test-model", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          prompt: prompt,
          backend: currentBackend,
          model: document.getElementById("modelSelect").value,
        }),
      });

      const data = await response.json();
      if (!response.ok) {
        outDiv.innerHTML = `<div class="text-red-600">ì˜¤ë¥˜: ${
          data.error || "ìš”ì²­ ì‹¤íŒ¨"
        }</div>`;
      } else {
        outDiv.innerHTML = `<p>${(data.response || "").replace(
          /\n/g,
          "<br>"
        )}</p>`;
      }
    } catch (error) {
      outDiv.innerHTML = `<div class="text-red-600">ì˜¤ë¥˜: ${error.message}</div>`;
    }
  }
</script>
{% endblock %}
