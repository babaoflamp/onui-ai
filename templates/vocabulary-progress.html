{% extends "base.html" %} {% block title %}ì–´íœ˜ ì§„ë„ - ì˜¤ëˆ„ì´ í•œêµ­ì–´ í•™ìŠµ{%
endblock %} {% block extra_css %}
<style>
  .vocab-word-row {
    transition: background 0.15s ease, transform 0.1s ease,
      box-shadow 0.15s ease;
  }

  .vocab-word-row:hover {
    background: #eef2ff;
    transform: translateY(-1px);
    box-shadow: 0 6px 10px rgba(148, 163, 184, 0.35);
  }

  .vocab-word-row.active {
    background: #e0e7ff;
    box-shadow: 0 0 0 2px #4f46e5;
  }

  .vocab-word-list {
    scrollbar-width: thin;
    scrollbar-color: #9ca3af #e5e7eb;
  }

  .vocab-word-list::-webkit-scrollbar {
    width: 6px;
  }

  .vocab-word-list::-webkit-scrollbar-thumb {
    background: #9ca3af;
    border-radius: 999px;
  }

  .vocab-word-list::-webkit-scrollbar-track {
    background: #e5e7eb;
    border-radius: 999px;
  }
</style>
{% endblock %} {% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">ğŸ“ˆ ì–´íœ˜ ì§„ë„</h1>
    <p class="text-gray-600 mt-2">
      ë‹¨ì–´ë³„ ì ìˆ˜ë¥¼ ì…ë ¥í•˜ê³  ìë™ ì •ë ¬ Â· íˆìŠ¤í† ë¦¬ ê·¸ë˜í”„ë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”.
    </p>
  </div>

  <!-- Main Layout -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Word List Panel (Left) -->
    <aside class="lg:col-span-1">
      <div
        class="bg-gradient-to-br from-gray-50 to-blue-50 rounded-2xl shadow-lg border border-blue-200 p-6"
      >
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-bold text-gray-900">ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸</h2>
          <span class="text-xs text-gray-500">ì ìˆ˜ ë†’ì€ ìˆœ</span>
        </div>

        <!-- List Header -->
        <div
          class="grid grid-cols-12 gap-2 text-xs text-gray-600 px-2 py-2 bg-white bg-opacity-70 rounded-lg border border-gray-300 mb-2"
        >
          <div class="col-span-5">ë‹¨ì–´</div>
          <div class="col-span-3 text-center">ì ìˆ˜</div>
          <div class="col-span-4 text-center">ì†ì„±</div>
        </div>

        <!-- Word List -->
        <div
          class="vocab-word-list bg-white bg-opacity-70 rounded-lg border border-gray-300 p-2 max-h-[500px] overflow-y-auto"
        >
          <div id="wordList"></div>
        </div>
      </div>
    </aside>

    <!-- Study Panel (Right) -->
    <section class="lg:col-span-2">
      <div class="flex flex-col gap-6">
        <!-- Current Word Card -->
        <div
          class="bg-gradient-to-br from-blue-50 to-white rounded-2xl shadow-lg border border-blue-200 p-6"
        >
          <div class="flex items-center justify-between mb-4">
            <div>
              <div
                class="text-xs uppercase tracking-wider text-indigo-600 font-bold mb-1"
              >
                Current Word
              </div>
              <div
                class="text-3xl font-extrabold text-gray-900"
                id="currentWord"
              >
                ?
              </div>
            </div>
            <div
              class="px-4 py-2 rounded-full bg-green-100 text-green-700 font-bold text-sm border border-green-300"
              id="currentScore"
            >
              ì ìˆ˜: ?
            </div>
          </div>

          <div class="mt-6">
            <div class="flex flex-wrap items-center gap-3">
              <label for="scoreInput" class="text-sm text-gray-600 font-medium"
                >ìƒˆ ì ìˆ˜ (0~100):</label
              >
              <input
                id="scoreInput"
                type="number"
                min="0"
                max="100"
                step="1"
                class="w-32 px-4 py-2 rounded-full border border-gray-300 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                placeholder="ì˜ˆ: 85"
              />
              <button
                id="submitScore"
                class="px-6 py-2 rounded-full bg-gradient-to-r from-indigo-600 to-indigo-700 text-white font-bold text-sm shadow-lg hover:shadow-xl hover:from-indigo-700 hover:to-indigo-800 transition-all duration-200 transform hover:-translate-y-0.5"
              >
                <span class="mr-1">â—</span> ì…ë ¥ & ì •ë ¬
              </button>
            </div>
            <p class="text-xs text-gray-500 mt-3">
              ì ìˆ˜ë¥¼ ì…ë ¥í•˜ë©´ í•´ë‹¹ ë‹¨ì–´ì˜ ì ìˆ˜ê°€ ì—…ë°ì´íŠ¸ë˜ê³ , ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸ê°€
              ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì •ë ¬ë©ë‹ˆë‹¤. (ë‹¨ì–´ ì´ë¦„ì„ í´ë¦­í•˜ë©´ í•™ìŠµ ë‹¨ì–´ë¥¼ ë°”ê¿€
              ìˆ˜ ìˆìŠµë‹ˆë‹¤.)
            </p>
          </div>
        </div>

        <!-- History Chart Card -->
        <div
          class="bg-gray-50 rounded-2xl shadow-lg border border-gray-300 p-6"
        >
          <div class="flex justify-between items-baseline mb-4">
            <h3 class="text-lg font-bold text-gray-900" id="historyTitle">
              ì ìˆ˜ íˆìŠ¤í† ë¦¬
            </h3>
            <span class="text-xs text-gray-500"
              >ë‹¨ì–´ ì˜†ì˜ [ì†ì„±] ë²„íŠ¼ì„ ëˆŒëŸ¬ ê·¸ë˜í”„ë¥¼ í™•ì¸í•˜ì„¸ìš”.</span
            >
          </div>
          <div class="bg-white rounded-lg p-4">
            <canvas id="historyChart" class="w-full" height="260"></canvas>
            <p id="historyEmpty" class="text-sm text-gray-400 text-center py-8">
              ì•„ì§ ì•„ë¬´ ë‹¨ì–´ë„ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¨ì–´ì˜
              <strong>[ì†ì„±]</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ ì ìˆ˜ ë³€í™”ë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”.
            </p>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<script>
  // ===== ë°ì´í„° ì´ˆê¸°í™” =====
  function randomScore() {
    return Math.floor(Math.random() * 51) + 50; // 50 ~ 100
  }

  const baseWords = [
    "í•™êµ",
    "ì‚¬ëŒ",
    "ìŒì‹",
    "ì±…",
    "ì¹œêµ¬",
    "ê°€ì¡±",
    "ì§‘",
    "ì‹œê°„",
    "ë‚˜ë¼",
    "ì¼",
    "ê³µë¶€",
    "ì‚¬ë‘",
    "ì‹œì¥",
    "ë²„ìŠ¤",
    "ë‚ ì”¨",
    "ì˜í™”",
    "ìŒì•…",
    "ì§ˆë¬¸",
    "ëŒ€ë‹µ",
    "ìƒê°",
  ];

  let words = baseWords.map((text, idx) => {
    const score = randomScore();
    return {
      id: idx + 1,
      text,
      score,
      history: [score],
    };
  });

  let currentWord = null;
  let lastHistoryWord = null;

  const wordListEl = document.getElementById("wordList");
  const currentWordEl = document.getElementById("currentWord");
  const currentScoreEl = document.getElementById("currentScore");
  const scoreInputEl = document.getElementById("scoreInput");
  const submitScoreBtn = document.getElementById("submitScore");

  const historyTitleEl = document.getElementById("historyTitle");
  const historyEmptyEl = document.getElementById("historyEmpty");
  const chartCanvas = document.getElementById("historyChart");
  const chartCtx = chartCanvas.getContext("2d");

  // ===== ë Œë”ë§ í•¨ìˆ˜ =====
  function sortWords() {
    words.sort((a, b) => b.score - a.score);
  }

  function renderWordList() {
    sortWords();
    wordListEl.innerHTML = "";

    words.forEach((word) => {
      const row = document.createElement("div");
      row.className =
        "vocab-word-row grid grid-cols-12 gap-2 items-center p-2 rounded-lg mb-1";
      if (currentWord && word.id === currentWord.id) {
        row.classList.add("active");
      }

      const wordBtn = document.createElement("button");
      wordBtn.className =
        "col-span-5 text-left px-3 py-2 rounded-full font-semibold text-sm text-gray-900 hover:bg-indigo-600 hover:text-white transition-colors";
      wordBtn.textContent = word.text;
      wordBtn.addEventListener("click", () => {
        currentWord = word;
        updateStudyPanel();
        renderWordList();
      });

      const scoreSpan = document.createElement("span");
      scoreSpan.className =
        "col-span-3 text-center px-2 py-1 rounded-full font-semibold text-xs bg-gray-100 text-gray-700";
      scoreSpan.textContent = word.score + "ì ";

      const attrBtn = document.createElement("button");
      attrBtn.className =
        "col-span-4 px-3 py-1 rounded-full text-xs font-semibold uppercase bg-cyan-100 text-cyan-700 border border-cyan-300 hover:bg-cyan-500 hover:text-white transition-all hover:-translate-y-0.5 hover:shadow-md";
      attrBtn.textContent = "ì†ì„±";
      attrBtn.addEventListener("click", () => {
        showHistory(word);
      });

      row.appendChild(wordBtn);
      row.appendChild(scoreSpan);
      row.appendChild(attrBtn);

      wordListEl.appendChild(row);
    });
  }

  function updateStudyPanel() {
    if (!currentWord) return;
    currentWordEl.textContent = currentWord.text;
    currentScoreEl.textContent = "ì ìˆ˜: " + currentWord.score + "ì ";
  }

  // ===== ê·¸ë˜í”„ ê·¸ë¦¬ê¸° =====
  function showHistory(word) {
    lastHistoryWord = word;
    historyTitleEl.textContent = `ã€Œ${word.text}ã€ ì ìˆ˜ íˆìŠ¤í† ë¦¬`;
    historyEmptyEl.style.display = "none";

    const parentWidth = chartCanvas.parentElement.clientWidth;
    chartCanvas.width = parentWidth > 280 ? parentWidth - 32 : 280;
    chartCanvas.height = 260;

    const ctx = chartCtx;
    ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);

    const data = word.history;
    if (!data || data.length === 0) {
      historyEmptyEl.style.display = "block";
      return;
    }

    const paddingLeft = 40;
    const paddingRight = 20;
    const paddingTop = 30;
    const paddingBottom = 40;
    const chartWidth = chartCanvas.width - paddingLeft - paddingRight;
    const chartHeight = chartCanvas.height - paddingTop - paddingBottom;

    const maxScore = Math.max(100, ...data);
    const minScore = Math.min(0, ...data);
    const range = maxScore - minScore || 1;

    // ---- ì¶• & ê·¸ë¦¬ë“œ ----
    ctx.save();
    ctx.lineWidth = 1;
    ctx.strokeStyle = "#d1d5db";
    ctx.beginPath();
    ctx.moveTo(paddingLeft, paddingTop);
    ctx.lineTo(paddingLeft, paddingTop + chartHeight);
    ctx.lineTo(paddingLeft + chartWidth, paddingTop + chartHeight);
    ctx.stroke();

    const yTicks = [50, 60, 70, 80, 90, 100];
    ctx.font = "12px Pretendard, system-ui";
    ctx.fillStyle = "#9ca3af";

    yTicks.forEach((tick) => {
      const y = paddingTop + ((maxScore - tick) / range) * chartHeight;
      if (y < paddingTop || y > paddingTop + chartHeight) return;

      ctx.strokeStyle = "#e5e7eb";
      ctx.beginPath();
      ctx.moveTo(paddingLeft, y);
      ctx.lineTo(paddingLeft + chartWidth, y);
      ctx.stroke();

      ctx.fillText(String(tick), 8, y + 4);
    });

    // ---- ë°ì´í„° ë¼ì¸ ----
    const stepX = data.length === 1 ? 0 : chartWidth / (data.length - 1);
    ctx.lineWidth = 2;
    ctx.strokeStyle = "#4f46e5";
    ctx.beginPath();

    data.forEach((value, index) => {
      const x = paddingLeft + stepX * index;
      const y = paddingTop + ((maxScore - value) / range) * chartHeight;
      if (index === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.stroke();

    // ---- í¬ì¸íŠ¸ í‘œì‹œ ----
    ctx.fillStyle = "#6366f1";
    data.forEach((value, index) => {
      const x = paddingLeft + stepX * index;
      const y = paddingTop + ((maxScore - value) / range) * chartHeight;
      ctx.beginPath();
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fill();
    });

    // ---- ì  ìœ„ì— ì ìˆ˜ ìˆ«ì í‘œì‹œ ----
    ctx.fillStyle = "#374151";
    ctx.font = "12px Pretendard, system-ui";
    data.forEach((value, index) => {
      const x = paddingLeft + stepX * index;
      const y = paddingTop + ((maxScore - value) / range) * chartHeight;
      ctx.fillText(String(value), x - 8, y - 8);
    });

    // ---- Xì¶• ë ˆì´ë¸” (ì‹œë„ ë²ˆí˜¸ 1,2,3â€¦) ----
    ctx.fillStyle = "#6b7280";
    ctx.font = "11px Pretendard, system-ui";
    data.forEach((_, index) => {
      const x = paddingLeft + stepX * index;
      const y = paddingTop + chartHeight + 16;
      ctx.fillText(String(index + 1), x - 3, y + 4);
    });

    ctx.restore();
  }

  // ===== ì´ë²¤íŠ¸ =====
  submitScoreBtn.addEventListener("click", () => {
    if (!currentWord) return;

    const value = scoreInputEl.value.trim();
    if (value === "") {
      alert("ì ìˆ˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”. (0~100)");
      scoreInputEl.focus();
      return;
    }

    const newScore = parseInt(value, 10);
    if (isNaN(newScore) || newScore < 0 || newScore > 100) {
      alert("0ì—ì„œ 100 ì‚¬ì´ì˜ ì •ìˆ˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
      scoreInputEl.focus();
      return;
    }

    // ë°ì´í„° ê°±ì‹ 
    currentWord.score = newScore;
    currentWord.history.push(newScore);

    // ì…ë ¥ì°½ ë¹„ìš°ê¸°
    scoreInputEl.value = "";

    // ë¦¬ìŠ¤íŠ¸ ì¬ë Œë” + íŒ¨ë„ ì—…ë°ì´íŠ¸
    renderWordList();
    updateStudyPanel();

    // ì´ë¯¸ ì´ ë‹¨ì–´ì˜ ê·¸ë˜í”„ë¥¼ ë³´ê³  ìˆë˜ ê²½ìš°, ê·¸ë˜í”„ë„ ê°±ì‹ 
    if (lastHistoryWord && lastHistoryWord.id === currentWord.id) {
      showHistory(currentWord);
    }
  });

  // Enter í‚¤ë¡œë„ ì…ë ¥ ê°€ëŠ¥í•˜ê²Œ
  scoreInputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      submitScoreBtn.click();
    }
  });

  // ===== ì´ˆê¸° ë Œë”ë§ =====
  (function init() {
    sortWords();
    // ì„ì˜ì˜ ë‹¨ì–´ ì„ íƒ
    currentWord = words[Math.floor(Math.random() * words.length)];
    renderWordList();
    updateStudyPanel();
  })();
</script>
{% endblock %}
