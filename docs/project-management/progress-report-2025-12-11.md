# 📊 오누이 한국어 프로젝트 진행상황 보고서

**작성일**: 2025년 12월 11일
**브랜치**: `feature/speechpro-gemini-integration`
**상태**: 활발히 개발 중

---

## 🎯 현재 브랜치

**`feature/speechpro-gemini-integration`** (원격 저장소와 동기화됨)

---

## ✅ 최근 완료된 주요 작업 (최근 20개 커밋 기준)

### 1️⃣ **발음 규칙 학습 리뉴얼** (가장 최근)

- ✅ 규칙 이해 / 예제 연습 **탭 전환 UI** 추가
- ✅ 정답 보기/숨기기 토글 개선
- ✅ 사용자 입력 정답 확인 기능 (실시간 채점)

### 2️⃣ **UI/UX 개선**

- ✅ 메일 팝업 → 모던 모달로 개선
- ✅ 해와 달 모양 파비콘 추가
- ✅ SpeechPro/FluencyPro 장점 섹션에 AI 복합 피드백 강조

### 3️⃣ **학습 진도 추적 시스템 구축** ⭐ (핵심 기능)

- ✅ 전체 학습 현황 커버리지 집계 (어휘/문장/콘텐츠 퍼센트)
- ✅ 발음 평가 성과 분포 기본값 보정
- ✅ 오늘의 학습 지표 필드 매핑 수정
- ✅ `vocabulary.json`, `sentences.json` 데이터셋 총량 캐싱

### 4️⃣ **AI 복합 피드백 시스템 구현** ⭐ (차별화 포인트)

- ✅ FluencyPro + SpeechPro 데이터 활용한 **세밀화된 피드백**
- ✅ 발음 정확도 평가 페이지에 AI 코멘트 추가
- ✅ 유창성 평가 결과 모달창 표시

### 5️⃣ **상황별 콘텐츠 생성 기능**

- ✅ AI 학습도구에 상황별 콘텐츠 생성 추가 (`/media-generation`)
- ✅ 전체 보기 링크 수정

### 6️⃣ **메뉴 구조 재정렬**

- ✅ 발음 학습 메뉴에서 중복 항목 제거 (발음 연습)
- ✅ AI 학습 메뉴에서 발음 교정 항목 제거 및 재정렬
- ✅ SpeechPro 프리셋 문장 레벨 조정 (PRESET → 초급)

---

## 📈 프로젝트 규모 현황

| 항목 | 수치 | 비고 |
|------|------|------|
| **백엔드 코드** | ~3,687 라인 | main.py (~2,917라인) + services (2개 파일) |
| **API 엔드포인트** | 71개 | FastAPI 라우트 |
| **템플릿 파일** | 27개 | Jinja2 HTML 페이지 |
| **학습 데이터** | 7개 JSON 파일 | sentences, expressions, vocabulary 등 |
| **최근 10개 커밋** | +1,868 / -196 라인 | 순증가 1,672 라인 |

---

## 🔄 현재 Git 상태

### Staged (커밋 대기 중)

- `README.md` (수정됨)

### Modified (작업 중)

- **핵심 파일**: `main.py`, `CLAUDE.md`, `learning_progress_service.py`
- **템플릿**: 11개 HTML 파일 수정
- **데이터베이스**: `users.db` 업데이트됨
- **로그**: `uvicorn.log` 업데이트됨

### Deleted (삭제 대기)

- 테스트 스크립트 5개: `test_*.py` (정리됨)
- 리포트 파일: `CURRICULUM_OPTIMIZATION_REPORT.md`, `MODEL_COMPARISON_REPORT.md`
- 문서: `SPEECHPRO_API_WORKFLOW.md`, `SPEECHPRO_IMPLEMENTATION.md`
- 디자인 파일 중복 제거

### Untracked (신규 파일)

- `docs/guide/` 디렉토리 (신규 문서)
- `docs/design/character.png`, `tiger_chatbot.svg` (캐릭터 이미지)
- `logs/detailed.log` (상세 로그)

---

## 🎯 핵심 요구사항 달성 현황

### ✅ **요구사항 1: 발음 평가 FeedBack 세밀화** (완료)

> 출처: `docs/requirements/REQ01-2025-12-09.md`

**구현 내용**:

- ✅ SpeechPro + FluencyPro 데이터 활용한 복합 피드백 시스템
- ✅ AI 코멘트 자동 생성 기능
- ✅ 별도 박스로 복합 피드백 표시
- 🎯 **차별화 포인트 확보됨**

### 🚧 **요구사항 2: 학습 진도 상황 캐릭터 팝업** (진행 중)

**구현 내용**:

- ✅ 학습 진도 추적 시스템 구축
- ✅ 데이터베이스 스키마 완성 (`popup_history` 테이블)
- ✅ 캐릭터 SVG 파일 준비 (`tiger_chatbot.svg`)
- ⏳ **팝업 UI 구현 필요** (캐릭터별 메시지 표시)
- ⏳ 이벤트 트리거 로직 구현 필요
  - 오빠(남동생): 현재 상황 안내
  - 호랑이: 경고와 독려
  - 여동생: 칭찬

**설계 방향**:

- 조선시대 방/대자보/게시판 스타일 편지 형식
- AI 에이전트가 학습 관리하는 느낌 연출
- 1개의 박스 동일 디자인, 색상으로 캐릭터 구분

---

## 🔧 기술 스택 현황

### 백엔드

- **FastAPI**: 웹 프레임워크
- **SQLite**: 사용자 인증 및 학습 진도 데이터
- **Ollama/Gemini**: AI 콘텐츠 생성 (듀얼 백엔드)
- **Python 3.8+**: 런타임 환경

### 외부 API 통합

- ✅ **SpeechPro API** (`http://112.220.79.222:33005/speechpro`)
  - GTP (Grapheme-to-Phoneme) 변환
  - Model 생성 (FST)
  - Score 평가
- ✅ **FluencyPro API** (`ws://112.220.79.218:33043/ws`)
  - WebSocket 기반 실시간 유창성 분석
  - 말하기 속도, 음절 정확도 평가
- ✅ **MzTTS API** (`http://112.220.79.218:56014`)
  - 전문 한국어 TTS (다중 화자)
  - 감정 제어 지원

### 프론트엔드

- **Jinja2 Templates**: 서버 사이드 렌더링
- **Tailwind CSS**: 유틸리티 기반 스타일링
- **Vanilla JavaScript**: 클라이언트 사이드 로직
- **MediaRecorder API**: 오디오 녹음

### 데이터

- **JSON 파일**: 학습 콘텐츠 저장 (7개 파일)
- **SQLite**: 사용자 데이터 및 진도 추적
- **파일 기반 세션**: 인메모리 토큰 저장

---

## 🚀 배포 상태

### 개발 서버

- **로컬**: `http://localhost:9000`
- **실행 스크립트**:
  - 시작: `./start-service.sh`
  - 종료: `./stop-service.sh`
- **자동 재시작**: uvicorn --reload 모드

### 프로덕션

- **Public URL**: `https://brainlessly-unequestrian-ember.ngrok-free.dev`
- **고정 도메인**: 유료 ngrok 계정 사용 중
- **모니터링**: `http://localhost:4040` (ngrok 대시보드)
- **로그 위치**:
  - uvicorn: `logs/uvicorn.log`
  - ngrok: `logs/ngrok.log`
  - 상세 로그: `logs/detailed.log`

### Systemd 서비스 (대안)

- **서비스 파일**: `onui-ai.service`
- 설치 가능하지만 현재는 스크립트 기반 운영

---

## 📝 다음 단계 제안

### ⭐ 우선순위 1: 캐릭터 팝업 시스템 완성

**구현 필요 사항**:

1. **팝업 컴포넌트 UI 구현**
   - 기존 `templates/components/character-popup.html` 활용
   - 캐릭터별 색상 테마 적용
   - 조선시대 편지 스타일 디자인

2. **이벤트 트리거 로직 구현**
   - 연속 학습일 달성 (3일, 7일, 14일, 30일)
   - 성취 마일스톤 도달 (학습 시간, 발음 점수)
   - 장기간 미접속 경고 (3일, 7일)
   - 레벨업 축하 메시지

3. **캐릭터별 메시지 템플릿 작성**
   - 오빠(남동생): 상황 안내 메시지
   - 호랑이: 경고 및 독려 메시지
   - 여동생: 칭찬 및 격려 메시지

4. **프론트엔드 통합**
   - 페이지 로드 시 팝업 체크
   - 모달 애니메이션 효과
   - 사용자 액션 로깅 (viewed, dismissed, clicked)

**예상 작업 시간**: 4-6시간

### 🔧 우선순위 2: 코드 리팩토링 검토

**현황**:
- `main.py`가 2,917라인으로 거대해짐
- 3,000라인 기준 근접 (리팩토링 권장 시점)

**제안 사항**:

1. **라우터 분리**
   ```
   routers/
   ├── auth.py          # 인증 관련 라우트
   ├── speechpro.py     # SpeechPro API 라우트
   ├── fluencypro.py    # FluencyPro API 라우트
   ├── learning.py      # 학습 콘텐츠 라우트
   ├── tts.py           # MzTTS API 라우트
   └── progress.py      # 학습 진도 라우트
   ```

2. **비즈니스 로직 서비스 분리**
   - 현재 2개 서비스만 분리됨
   - AI 모델 호출 로직 서비스화
   - 인증 로직 미들웨어화

3. **설정 파일 분리**
   - `config.py`로 환경 변수 관리 통합

**예상 작업 시간**: 6-8시간

### 📚 우선순위 3: 문서 정리

**완료된 작업**:
- ✅ `CLAUDE.md` 대폭 업데이트 (2025-12-11)
- ✅ 불필요한 리포트 파일 삭제 대기 중

**남은 작업**:

1. **신규 가이드 문서 작성** (`docs/guide/`)
   - 사용자 가이드
   - 관리자 가이드
   - API 사용 가이드

2. **API 문서 통합**
   - 현재: `docs/api/` 하위에 분산됨
   - 제안: Swagger/OpenAPI 자동 문서 활용

3. **프로젝트 관리 문서 정기 업데이트**
   - 주간 진행상황 보고서
   - 월간 마일스톤 체크

**예상 작업 시간**: 3-4시간

### 🐛 우선순위 4: 버그 수정 및 최적화

**잠재적 이슈**:

1. **보안**
   - SHA-256 패스워드 해싱 → bcrypt/argon2 업그레이드
   - 세션 토큰 만료 시간 설정
   - CORS 설정 화이트리스트화

2. **성능**
   - 대용량 오디오 파일 처리 최적화
   - JSON 데이터 캐싱 전략
   - 데이터베이스 인덱스 최적화

3. **사용자 경험**
   - 로딩 인디케이터 일관성
   - 에러 메시지 한국어화
   - 모바일 반응형 개선

---

## 🎉 주요 성과

1. ✅ **AI 복합 피드백 시스템** 구현으로 **경쟁 서비스 차별화** 달성
2. ✅ **학습 진도 추적 시스템** 인프라 완성 (DB + 백엔드 로직)
3. ✅ **발음 규칙 학습** 인터랙티브 기능 강화
4. ✅ **프로덕션 배포 환경** 안정화 (ngrok + systemd)
5. ✅ 최근 10개 커밋에서 **순증가 1,672 라인** (활발한 개발 진행 중)
6. ✅ **3개 외부 API 통합 완료** (SpeechPro, FluencyPro, MzTTS)

---

## 📊 개발 속도 지표

### 최근 20개 커밋 분석

- **평균 커밋 간격**: ~1일
- **커밋 카테고리**:
  - `feat`: 13개 (신규 기능)
  - `fix`: 5개 (버그 수정)
  - `design`: 2개 (디자인 개선)
  - `refactor`: 1개 (코드 정리)

### 개발 집중 영역

1. **발음 평가 시스템** (35%)
2. **학습 진도 추적** (25%)
3. **UI/UX 개선** (20%)
4. **AI 통합** (15%)
5. **기타** (5%)

---

## 🎯 마일스톤 현황

### Phase 1: 핵심 기능 구현 (완료)
- ✅ SpeechPro/FluencyPro 통합
- ✅ AI 복합 피드백 시스템
- ✅ 학습 진도 추적 인프라
- ✅ 사용자 인증 시스템

### Phase 2: 사용자 경험 개선 (진행 중)
- ✅ 발음 규칙 인터랙티브 학습
- 🚧 캐릭터 팝업 시스템
- ⏳ 모바일 최적화
- ⏳ 다국어 지원 확대

### Phase 3: 확장 및 최적화 (예정)
- ⏳ 코드 리팩토링
- ⏳ 성능 최적화
- ⏳ 보안 강화
- ⏳ API 문서화

---

## 💡 기술 부채 (Technical Debt)

### 긴급 (High Priority)
- 🔴 `main.py` 파일 크기 (2,917라인) - 리팩토링 필요
- 🔴 SHA-256 패스워드 해싱 → bcrypt 업그레이드
- 🔴 세션 토큰 만료 시간 미설정

### 중요 (Medium Priority)
- 🟡 테스트 코드 부재
- 🟡 API 에러 핸들링 일관성 부족
- 🟡 프론트엔드 상태 관리 미흡

### 보통 (Low Priority)
- 🟢 주석 및 docstring 부족
- 🟢 타입 힌팅 불완전
- 🟢 로깅 전략 통일 필요

---

## 📞 팀 커뮤니케이션

### 주요 의사결정 필요 사항

1. **캐릭터 팝업 메시지 톤앤매너**
   - 격식체 vs 반말체
   - 이모지 사용 여부
   - 문장 길이 가이드

2. **코드 리팩토링 일정**
   - 언제 진행할 것인가?
   - 단계적 접근 vs 일괄 리팩토링

3. **다음 스프린트 우선순위**
   - 캐릭터 팝업 완성?
   - 모바일 최적화?
   - 보안 강화?

---

## 📅 다음 보고서 예정일

**2025년 12월 18일** (1주일 후)

---

**종합 평가**: 프로젝트는 **활발하게 진행 중**이며, 핵심 차별화 기능(AI 복합 피드백)이 구현 완료되었습니다. 캐릭터 팝업 시스템만 완성되면 Phase 2의 주요 요구사항이 모두 달성됩니다! 🚀

**건강도 점수**: ⭐⭐⭐⭐☆ (4/5)
- 기능 완성도: 80%
- 코드 품질: 70%
- 문서화: 85%
- 배포 안정성: 90%
